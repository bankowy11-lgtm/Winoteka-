<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skaner Win W≈Çoskich</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU2thbmVyIFdpbiBXxYJvc2tpY2giLCJzaG9ydF9uYW1lIjoiV2luZVNjYW4iLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzJEMUIzRCIsInRoZW1lX2NvbG9yIjoiIzJEMUIzRCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVEk0SWlCb1pXbG5hSFE5SWpFeU9DSWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklqNDhjbVZqZENCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0lnWm1sc2JEMGlJek5ETWtReE55SXZQand2YzNablBnPT0iLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    <style>
        body {
            background: linear-gradient(135deg, #2D1B3D 0%, #5C3D6F 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .wine-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .wine-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .scanner-container {
            border: 3px dashed #9C27B0;
            border-radius: 16px;
            overflow: hidden;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Baza danych win w≈Çoskich
        const wineDatabase = {
            '8004300000311': {
                name: 'Chianti Classico DOCG',
                producer: 'Castello di Brolio',
                region: 'Toskania',
                type: 'Wytrawne',
                grapes: 'Sangiovese',
                year: 2020,
                alcohol: '13.5%',
                color: '#8B0000'
            },
            '8000140952088': {
                name: 'Barolo DOCG',
                producer: 'Fontanafredda',
                region: 'Piemont',
                type: 'Wytrawne',
                grapes: 'Nebbiolo',
                year: 2018,
                alcohol: '14%',
                color: '#8B0000'
            },
            '8002915001884': {
                name: 'Prosecco DOC',
                producer: 'Zonin',
                region: 'Veneto',
                type: 'Wytrawne',
                grapes: 'Glera',
                year: 2022,
                alcohol: '11%',
                color: '#F0E68C'
            },
            '8033638821015': {
                name: 'Lambrusco Emilia IGT',
                producer: 'Cantine Riunite',
                region: 'Emilia-Romagna',
                type: 'P√≥≈Çs≈Çodkie',
                grapes: 'Lambrusco',
                year: 2023,
                alcohol: '8%',
                color: '#8B0000'
            },
            '8004300000328': {
                name: 'Brunello di Montalcino DOCG',
                producer: 'Banfi',
                region: 'Toskania',
                type: 'Wytrawne',
                grapes: 'Sangiovese Grosso',
                year: 2017,
                alcohol: '14.5%',
                color: '#8B0000'
            },
            '8000730000106': {
                name: 'Amarone della Valpolicella DOCG',
                processor: 'Masi',
                region: 'Veneto',
                type: 'P√≥≈Çwytrawne',
                grapes: 'Corvina, Rondinella',
                year: 2016,
                alcohol: '15%',
                color: '#8B0000'
            },
            '8003625007067': {
                name: 'Moscato d\'Asti DOCG',
                producer: 'Martini & Rossi',
                region: 'Piemont',
                type: 'S≈Çodkie',
                grapes: 'Moscato Bianco',
                year: 2023,
                alcohol: '5.5%',
                color: '#FFE4B5'
            },
            '8001915007367': {
                name: 'Pinot Grigio delle Venezie DOC',
                producer: 'Santa Margherita',
                region: 'Veneto',
                type: 'Wytrawne',
                grapes: 'Pinot Grigio',
                year: 2022,
                alcohol: '12%',
                color: '#F0E68C'
            },
            '8002915003246': {
                name: 'Montepulciano d\'Abruzzo DOC',
                producer: 'Umani Ronchi',
                region: 'Abruzzo',
                type: 'Wytrawne',
                grapes: 'Montepulciano',
                year: 2021,
                alcohol: '13%',
                color: '#8B0000'
            },
            '8033638821022': {
                name: 'Asti Spumante DOCG',
                producer: 'Cinzano',
                region: 'Piemont',
                type: 'S≈Çodkie',
                grapes: 'Moscato',
                year: 2023,
                alcohol: '7%',
                color: '#FFE4B5'
            }
        };

        function WineScannerApp() {
            const [scanning, setScanning] = useState(false);
            const [scannedWine, setScannedWine] = useState(null);
            const [view, setView] = useState('home'); // 'home', 'scanner', 'database'
            const [searchTerm, setSearchTerm] = useState('');
            const scannerRef = useRef(null);
            const html5QrCodeRef = useRef(null);

            const getTypeColor = (type) => {
                switch(type) {
                    case 'Wytrawne': return 'bg-red-600';
                    case 'P√≥≈Çwytrawne': return 'bg-orange-500';
                    case 'P√≥≈Çs≈Çodkie': return 'bg-pink-500';
                    case 'S≈Çodkie': return 'bg-purple-500';
                    default: return 'bg-gray-600';
                }
            };

            const getTypeIcon = (type) => {
                switch(type) {
                    case 'Wytrawne': return 'üç∑';
                    case 'P√≥≈Çwytrawne': return 'üçæ';
                    case 'P√≥≈Çs≈Çodkie': return 'ü•Ç';
                    case 'S≈Çodkie': return 'üçØ';
                    default: return 'üçá';
                }
            };

            const startScanner = async () => {
                setView('scanner');
                setScanning(true);
                
                setTimeout(() => {
                    if (scannerRef.current && !html5QrCodeRef.current) {
                        html5QrCodeRef.current = new Html5Qrcode("reader");
                        
                        html5QrCodeRef.current.start(
                            { facingMode: "environment" },
                            {
                                fps: 10,
                                qrbox: { width: 250, height: 250 }
                            },
                            (decodedText) => {
                                onScanSuccess(decodedText);
                            },
                            (errorMessage) => {
                                // Ignoruj b≈Çƒôdy skanowania
                            }
                        ).catch(err => {
                            console.error("B≈ÇƒÖd kamery:", err);
                            alert("Nie mo≈ºna uzyskaƒá dostƒôpu do kamery. Upewnij siƒô, ≈ºe udzieli≈Çe≈õ uprawnie≈Ñ.");
                        });
                    }
                }, 100);
            };

            const stopScanner = () => {
                if (html5QrCodeRef.current) {
                    html5QrCodeRef.current.stop().then(() => {
                        html5QrCodeRef.current = null;
                        setScanning(false);
                        setView('home');
                    }).catch(err => {
                        console.error("B≈ÇƒÖd zatrzymania skanera:", err);
                    });
                }
            };

            const onScanSuccess = (barcode) => {
                const wine = wineDatabase[barcode];
                if (wine) {
                    setScannedWine(wine);
                    stopScanner();
                } else {
                    alert(`Nie znaleziono wina o kodzie: ${barcode}\n\nSpr√≥buj zeskanowaƒá inny kod lub przeglƒÖdnij bazƒô danych.`);
                }
            };

            const filteredWines = Object.entries(wineDatabase).filter(([barcode, wine]) =>
                wine.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                wine.producer.toLowerCase().includes(searchTerm.toLowerCase()) ||
                wine.region.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <div className="min-h-screen pb-20">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-purple-900 to-indigo-900 text-white p-6 shadow-2xl">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="text-4xl">üç∑</div>
                                <div>
                                    <h1 className="text-2xl font-bold">Skaner Win</h1>
                                    <p className="text-purple-200 text-sm">Wina w≈Çoskie</p>
                                </div>
                            </div>
                            <div className="text-right">
                                <div className="text-sm text-purple-200">Baza danych</div>
                                <div className="text-xl font-bold">{Object.keys(wineDatabase).length} win</div>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="p-4">
                        {view === 'home' && (
                            <div className="space-y-6">
                                {/* Action Buttons */}
                                <div className="grid grid-cols-2 gap-4">
                                    <button
                                        onClick={startScanner}
                                        className="bg-gradient-to-br from-purple-600 to-pink-600 text-white p-6 rounded-2xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all"
                                    >
                                        <div className="text-4xl mb-2">üì±</div>
                                        <div className="font-bold text-lg">Skanuj kod</div>
                                        <div className="text-xs opacity-90">Zeskanuj butelkƒô</div>
                                    </button>
                                    
                                    <button
                                        onClick={() => setView('database')}
                                        className="bg-gradient-to-br from-indigo-600 to-blue-600 text-white p-6 rounded-2xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all"
                                    >
                                        <div className="text-4xl mb-2">üìö</div>
                                        <div className="font-bold text-lg">Baza win</div>
                                        <div className="text-xs opacity-90">PrzeglƒÖdaj kolekcjƒô</div>
                                    </button>
                                </div>

                                {/* Scanned Wine Display */}
                                {scannedWine && (
                                    <div className="wine-card rounded-2xl shadow-2xl overflow-hidden">
                                        <div className={`${getTypeColor(scannedWine.type)} text-white p-4`}>
                                            <div className="flex items-center justify-between">
                                                <div className="text-3xl">{getTypeIcon(scannedWine.type)}</div>
                                                <div className="text-right">
                                                    <div className="text-sm opacity-90">Ostatnio zeskanowane</div>
                                                    <div className="font-bold text-lg">{scannedWine.type}</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div className="p-6">
                                            <h2 className="text-2xl font-bold text-gray-800 mb-2">{scannedWine.name}</h2>
                                            <p className="text-purple-600 font-semibold mb-4">{scannedWine.producer}</p>
                                            
                                            <div className="grid grid-cols-2 gap-4 mb-4">
                                                <div className="bg-purple-50 p-3 rounded-lg">
                                                    <div className="text-xs text-gray-600">Region</div>
                                                    <div className="font-semibold text-gray-800">{scannedWine.region}</div>
                                                </div>
                                                <div className="bg-purple-50 p-3 rounded-lg">
                                                    <div className="text-xs text-gray-600">Rocznik</div>
                                                    <div className="font-semibold text-gray-800">{scannedWine.year}</div>
                                                </div>
                                                <div className="bg-purple-50 p-3 rounded-lg">
                                                    <div className="text-xs text-gray-600">Szczep</div>
                                                    <div className="font-semibold text-gray-800">{scannedWine.grapes}</div>
                                                </div>
                                                <div className="bg-purple-50 p-3 rounded-lg">
                                                    <div className="text-xs text-gray-600">Alkohol</div>
                                                    <div className="font-semibold text-gray-800">{scannedWine.alcohol}</div>
                                                </div>
                                            </div>

                                            <button
                                                onClick={() => setScannedWine(null)}
                                                className="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                                            >
                                                Zamknij
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Quick Stats */}
                                <div className="grid grid-cols-4 gap-2">
                                    {['Wytrawne', 'P√≥≈Çwytrawne', 'P√≥≈Çs≈Çodkie', 'S≈Çodkie'].map(type => {
                                        const count = Object.values(wineDatabase).filter(w => w.type === type).length;
                                        return (
                                            <div key={type} className="bg-white rounded-xl p-3 shadow-lg text-center">
                                                <div className="text-2xl mb-1">{getTypeIcon(type)}</div>
                                                <div className="text-xs text-gray-600 mb-1">{type}</div>
                                                <div className="font-bold text-purple-600">{count}</div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {view === 'scanner' && (
                            <div className="space-y-4">
                                <div className="scanner-container bg-black">
                                    <div id="reader" ref={scannerRef} style={{ width: '100%' }}></div>
                                </div>
                                
                                <div className="text-center text-white">
                                    <div className="pulse text-4xl mb-2">üì∑</div>
                                    <p className="font-semibold">Skieruj kamerƒô na kod kreskowy</p>
                                    <p className="text-sm text-purple-200 mt-2">Kod zostanie zeskanowany automatycznie</p>
                                </div>

                                <button
                                    onClick={stopScanner}
                                    className="w-full bg-red-500 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-red-600 transition-colors"
                                >
                                    Anuluj skanowanie
                                </button>
                            </div>
                        )}

                        {view === 'database' && (
                            <div className="space-y-4">
                                <div className="flex items-center gap-2">
                                    <button
                                        onClick={() => setView('home')}
                                        className="bg-white p-3 rounded-xl shadow-lg text-purple-600 font-bold"
                                    >
                                        ‚Üê Powr√≥t
                                    </button>
                                    <input
                                        type="text"
                                        placeholder="Szukaj wina..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="flex-1 p-3 rounded-xl shadow-lg border-2 border-purple-200 focus:border-purple-500 outline-none"
                                    />
                                </div>

                                <div className="space-y-3">
                                    {filteredWines.map(([barcode, wine]) => (
                                        <div key={barcode} className="wine-card rounded-xl shadow-lg overflow-hidden">
                                            <div className={`${getTypeColor(wine.type)} text-white px-4 py-2 flex items-center justify-between`}>
                                                <span className="text-xl">{getTypeIcon(wine.type)}</span>
                                                <span className="font-semibold text-sm">{wine.type}</span>
                                            </div>
                                            <div className="p-4">
                                                <h3 className="font-bold text-lg text-gray-800 mb-1">{wine.name}</h3>
                                                <p className="text-purple-600 text-sm mb-2">{wine.producer}</p>
                                                <div className="flex items-center justify-between text-xs text-gray-600">
                                                    <span>üìç {wine.region}</span>
                                                    <span>üçá {wine.grapes}</span>
                                                    <span>üìÖ {wine.year}</span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<WineScannerApp />, document.getElementById('root'));
    </script>
</body>
</html>