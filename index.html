<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a0e0e">
    <meta name="description" content="Skaner kod√≥w kreskowych w≈Çoskich win">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Vino Scanner - Skaner Win W≈Çoskich</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>üç∑</text></svg>">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;700&family=Cinzel:wght@400;600&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- QuaggaJS for barcode scanning -->
    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.7.7/dist/quagga.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Text', serif;
            background: linear-gradient(135deg, #1a0e0e 0%, #3d1616 50%, #1a0e0e 100%);
            min-height: 100vh;
            color: #f5deb3;
            overflow-x: hidden;
            position: relative;
        }

        /* Background decorations */
        .bg-decoration {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }

        .bg-glow-1 {
            position: absolute;
            top: 80px;
            left: 40px;
            width: 384px;
            height: 384px;
            border-radius: 50%;
            background: #d97706;
            opacity: 0.1;
            filter: blur(80px);
        }

        .bg-glow-2 {
            position: absolute;
            bottom: 80px;
            right: 40px;
            width: 384px;
            height: 384px;
            border-radius: 50%;
            background: #7f1d1d;
            opacity: 0.1;
            filter: blur(80px);
        }

        .grain-overlay {
            position: absolute;
            inset: 0;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' /%3E%3C/svg%3E");
            background-repeat: repeat;
        }

        /* Container */
        .container {
            position: relative;
            z-index: 10;
            max-width: 1024px;
            margin: 0 auto;
            padding: 0 24px 80px;
        }

        /* Header */
        .header {
            padding: 48px 0 32px;
            text-align: center;
        }

        .header-title-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 12px;
        }

        .wine-icon {
            width: 48px;
            height: 48px;
            color: #fbbf24;
        }

        .header-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 48px;
            font-weight: 300;
            letter-spacing: 0.1em;
            color: #fef3c7;
        }

        .header-subtitle {
            font-family: 'Cinzel', serif;
            font-size: 12px;
            letter-spacing: 0.2em;
            color: rgba(252, 211, 77, 0.7);
            text-transform: uppercase;
        }

        .info-button {
            margin: 16px auto 0;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: rgba(251, 191, 36, 0.6);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 12px;
            transition: color 0.3s;
        }

        .info-button:hover {
            color: #fbbf24;
        }

        .info-box {
            display: none;
            margin-top: 16px;
            padding: 24px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(180, 83, 9, 0.3);
            border-radius: 8px;
        }

        .info-box.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .info-box h3 {
            color: #fcd34d;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .info-box ul {
            color: rgba(254, 243, 199, 0.8);
            font-size: 14px;
            line-height: 1.8;
            list-style: none;
        }

        .info-box li {
            margin-bottom: 8px;
        }

        /* Main content */
        .content {
            display: none;
        }

        .content.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        /* Scan button */
        .scan-button {
            width: 100%;
            padding: 24px 32px;
            background: linear-gradient(to right, rgba(120, 53, 15, 0.5), rgba(127, 29, 29, 0.5));
            backdrop-filter: blur(16px);
            border: 2px solid rgba(217, 119, 6, 0.4);
            border-radius: 16px;
            color: #fef3c7;
            font-family: 'Cinzel', serif;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        .scan-button:hover {
            border-color: rgba(245, 158, 11, 0.6);
            transform: translateY(-2px);
        }

        /* Manual input */
        .manual-input-wrapper {
            position: relative;
            margin-top: 24px;
        }

        .manual-input-label {
            position: absolute;
            top: -12px;
            left: 24px;
            padding: 0 12px;
            background: linear-gradient(to right, #450a0a, #78350f);
            font-size: 10px;
            color: rgba(251, 191, 36, 0.7);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            z-index: 10;
        }

        .manual-input-box {
            padding: 24px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(180, 83, 9, 0.3);
            border-radius: 12px;
        }

        .manual-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(146, 64, 14, 0.4);
            border-radius: 8px;
            color: #fef3c7;
            font-family: 'Crimson Text', serif;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .manual-input::placeholder {
            color: rgba(180, 83, 9, 0.5);
        }

        .manual-input:focus {
            outline: none;
            border-color: rgba(217, 119, 6, 0.6);
        }

        .manual-search-button {
            margin-top: 12px;
            width: 100%;
            padding: 8px 16px;
            background: rgba(120, 53, 15, 0.4);
            border: 1px solid rgba(146, 64, 14, 0.4);
            border-radius: 8px;
            color: #fcd34d;
            cursor: pointer;
            transition: all 0.3s;
        }

        .manual-search-button:hover {
            background: rgba(120, 53, 15, 0.6);
        }

        /* Sample codes */
        .sample-codes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 24px;
        }

        .sample-code {
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(180, 83, 9, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            opacity: 0;
            animation: fadeIn 0.6s ease-out forwards;
        }

        .sample-code:nth-child(1) { animation-delay: 0ms; }
        .sample-code:nth-child(2) { animation-delay: 100ms; }
        .sample-code:nth-child(3) { animation-delay: 200ms; }
        .sample-code:nth-child(4) { animation-delay: 300ms; }

        .sample-code:hover {
            border-color: rgba(146, 64, 14, 0.4);
        }

        .sample-code-label {
            font-size: 10px;
            color: rgba(217, 119, 6, 0.7);
            margin-bottom: 4px;
        }

        .sample-code-number {
            font-size: 14px;
            color: #fcd34d;
            font-family: monospace;
        }

        .sample-code-name {
            font-size: 10px;
            color: rgba(251, 191, 36, 0.6);
            margin-top: 4px;
        }

        /* Scanner */
        #scanner-container {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid rgba(217, 119, 6, 0.4);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            margin-bottom: 16px;
        }

        #interactive {
            width: 100%;
            height: 400px;
            background: #000;
        }

        #interactive video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #interactive canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #interactive canvas.drawingBuffer {
            position: absolute;
            top: 0;
            left: 0;
        }

        .scanner-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .scanner-frame {
            position: relative;
            width: 256px;
            height: 128px;
            border: 2px solid rgba(251, 191, 36, 0.6);
            border-radius: 8px;
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.3);
            animation: pulse 2s ease-in-out infinite;
        }

        .scanner-corner {
            position: absolute;
            width: 24px;
            height: 24px;
            border-color: #fbbf24;
        }

        .scanner-corner.top-left {
            top: 0;
            left: 0;
            border-top: 4px solid;
            border-left: 4px solid;
        }

        .scanner-corner.top-right {
            top: 0;
            right: 0;
            border-top: 4px solid;
            border-right: 4px solid;
        }

        .scanner-corner.bottom-left {
            bottom: 0;
            left: 0;
            border-bottom: 4px solid;
            border-left: 4px solid;
        }

        .scanner-corner.bottom-right {
            bottom: 0;
            right: 0;
            border-bottom: 4px solid;
            border-right: 4px solid;
        }

        .scanner-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            padding: 16px;
            text-align: center;
            color: #fcd34d;
            font-size: 14px;
        }

        .stop-button {
            width: 100%;
            padding: 16px 24px;
            background: rgba(127, 29, 29, 0.5);
            border: 1px solid rgba(185, 28, 28, 0.4);
            border-radius: 12px;
            color: #fef3c7;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .stop-button:hover {
            background: rgba(127, 29, 29, 0.7);
        }

        /* Wine result */
        .wine-result {
            animation: slideUp 0.6s ease-out;
        }

        .success-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .success-icon {
            color: #4ade80;
        }

        .wine-card {
            position: relative;
            padding: 32px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4));
            backdrop-filter: blur(16px);
            border: 2px solid;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .wine-card-glow {
            position: absolute;
            top: 0;
            right: 0;
            width: 128px;
            height: 128px;
            opacity: 0.2;
            border-radius: 50%;
            filter: blur(40px);
        }

        .wine-bottle-icon {
            text-align: center;
            margin-bottom: 24px;
            position: relative;
        }

        .wine-bottle-icon svg {
            width: 80px;
            height: 80px;
            position: relative;
            z-index: 10;
        }

        .wine-name {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 36px;
            font-weight: 300;
            text-align: center;
            color: #fef3c7;
            margin-bottom: 8px;
            letter-spacing: 0.05em;
        }

        .wine-region {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .wine-region svg {
            width: 16px;
            height: 16px;
            color: rgba(251, 191, 36, 0.6);
        }

        .wine-region-text {
            font-family: 'Cinzel', serif;
            font-size: 12px;
            letter-spacing: 0.2em;
            color: rgba(251, 191, 36, 0.8);
            text-transform: uppercase;
        }

        .wine-type-badge {
            display: flex;
            justify-content: center;
            margin-bottom: 32px;
        }

        .wine-type-badge-inner {
            padding: 16px 32px;
            border-radius: 9999px;
            border: 2px solid;
            box-shadow: 0 0 30px;
            font-family: 'Cinzel', serif;
            font-size: 24px;
            font-weight: 600;
            letter-spacing: 0.1em;
        }

        .wine-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .wine-detail {
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(180, 83, 9, 0.2);
        }

        .wine-detail-label {
            font-size: 10px;
            color: rgba(217, 119, 6, 0.7);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .wine-detail-value {
            color: #fcd34d;
            font-size: 16px;
        }

        .wine-detail-value.barcode {
            font-family: monospace;
            font-size: 14px;
        }

        .new-scan-button {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(to right, rgba(120, 53, 15, 0.4), rgba(127, 29, 29, 0.4));
            border: 1px solid rgba(146, 64, 14, 0.4);
            border-radius: 12px;
            color: #fcd34d;
            cursor: pointer;
            transition: all 0.3s;
        }

        .new-scan-button:hover {
            border-color: rgba(217, 119, 6, 0.6);
        }

        .type-legend {
            margin-top: 16px;
            padding: 24px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(180, 83, 9, 0.2);
            border-radius: 12px;
        }

        .type-legend-title {
            color: #fcd34d;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .type-legend-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 14px;
        }

        .type-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .type-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .type-legend-text {
            color: rgba(254, 243, 199, 0.7);
        }

        /* Install prompt */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            max-width: 400px;
            margin: 0 auto;
            padding: 16px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(217, 119, 6, 0.4);
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }

        .install-prompt.active {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        .install-prompt-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .install-prompt-text {
            flex: 1;
            font-size: 14px;
            color: #fcd34d;
        }

        .install-prompt-buttons {
            display: flex;
            gap: 8px;
        }

        .install-prompt-button {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .install-prompt-button.primary {
            background: rgba(217, 119, 6, 0.8);
            color: #fff;
        }

        .install-prompt-button.secondary {
            background: rgba(120, 53, 15, 0.4);
            color: #fcd34d;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Responsive */
        @media (max-width: 640px) {
            .header-title {
                font-size: 32px;
            }

            .wine-name {
                font-size: 28px;
            }

            .sample-codes {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="bg-decoration">
        <div class="bg-glow-1"></div>
        <div class="bg-glow-2"></div>
        <div class="grain-overlay"></div>
    </div>

    <div class="container">
        <header class="header">
            <div class="header-title-wrapper">
                <svg class="wine-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
                </svg>
                <h1 class="header-title">VINO SCANNER</h1>
            </div>
            <p class="header-subtitle">Odkryj tajemnice w≈Çoskich win</p>
            
            <button class="info-button" onclick="toggleInfo()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10" stroke-width="2"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 16v-4m0-4h.01"/>
                </svg>
                <span>Jak u≈ºywaƒá</span>
            </button>

            <div id="info-box" class="info-box">
                <h3>Instrukcja u≈ºycia:</h3>
                <ul>
                    <li>‚Ä¢ Kliknij "Skanuj kod kreskowy" aby uruchomiƒá kamerƒô</li>
                    <li>‚Ä¢ <strong>WA≈ªNE: Musisz przyznaƒá uprawnienia do kamery!</strong></li>
                    <li>‚Ä¢ Skieruj kamerƒô na kod kreskowy na butelce wina</li>
                    <li>‚Ä¢ Lub wprowad≈∫ kod rƒôcznie w polu tekstowym</li>
                    <li>‚Ä¢ Przyk≈Çadowe kody: 8001935001706, 8002915001234</li>
                    <li>‚Ä¢ Mo≈ºesz zainstalowaƒá aplikacjƒô na swoim telefonie!</li>
                </ul>
                <div style="margin-top: 12px; padding: 12px; background: rgba(220, 38, 38, 0.2); border: 1px solid rgba(220, 38, 38, 0.4); border-radius: 6px;">
                    <strong>‚ö†Ô∏è Problemy z kamerƒÖ?</strong><br>
                    Aplikacja wymaga HTTPS! Otw√≥rz przez GitHub Pages, nie lokalnie.
                </div>
            </div>
        </header>

        <!-- Home view -->
        <div id="home-view" class="content active">
            <button class="scan-button" onclick="startScanner()">
                <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span>Skanuj kod kreskowy</span>
            </button>

            <div class="manual-input-wrapper">
                <div class="manual-input-label">Rƒôczne wprowadzenie</div>
                <div class="manual-input-box">
                    <input 
                        type="text" 
                        id="manual-input" 
                        class="manual-input"
                        placeholder="Wprowad≈∫ kod kreskowy..."
                        onkeypress="if(event.key==='Enter') searchManual()"
                    >
                    <button class="manual-search-button" onclick="searchManual()">
                        Wyszukaj
                    </button>
                </div>
            </div>

            <div class="sample-codes" id="sample-codes"></div>
        </div>

        <!-- Scanner view -->
        <div id="scanner-view" class="content">
            <div id="scanner-container">
                <div id="interactive" class="viewport"></div>
                <div class="scanner-overlay">
                    <div class="scanner-frame">
                        <div class="scanner-corner top-left"></div>
                        <div class="scanner-corner top-right"></div>
                        <div class="scanner-corner bottom-left"></div>
                        <div class="scanner-corner bottom-right"></div>
                    </div>
                </div>
                <div class="scanner-info">
                    <strong>Wskaz√≥wki:</strong><br>
                    Trzymaj telefon stabilnie ‚Ä¢ Dobre ≈õwiat≈Ço ‚Ä¢ Kod prostopadle do kamery
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                <button class="stop-button" onclick="stopScanner()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                    <span>Anuluj</span>
                </button>
                <button class="stop-button" onclick="testDetection()" style="background: rgba(34, 197, 94, 0.3); border-color: rgba(34, 197, 94, 0.4);">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>Test</span>
                </button>
            </div>
            
            <div style="padding: 16px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(180, 83, 9, 0.3); border-radius: 12px; text-align: center; color: rgba(251, 191, 36, 0.7); font-size: 12px; line-height: 1.6;">
                <strong>Problemy ze skanowaniem?</strong><br>
                ‚Ä¢ Przybli≈º lub oddal kod od kamery<br>
                ‚Ä¢ W≈ÇƒÖcz latarkƒô przy s≈Çabym ≈õwietle<br>
                ‚Ä¢ Kliknij "Test" aby symulowaƒá wykrycie<br>
                ‚Ä¢ U≈ºyj rƒôcznego wprowadzania poni≈ºej
            </div>
        </div>

        <!-- Result view -->
        <div id="result-view" class="content">
            <div class="wine-result">
                <div class="success-indicator">
                    <svg class="success-icon" width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span style="color: #fcd34d; font-size: 18px;">Wino zidentyfikowane!</span>
                </div>

                <div id="wine-card" class="wine-card"></div>

                <div class="type-legend">
                    <div class="type-legend-title">Typy win</div>
                    <div class="type-legend-items">
                        <div class="type-legend-item">
                            <div class="type-legend-color" style="background-color: #D4AF37;"></div>
                            <span class="type-legend-text">S≈Çodkie</span>
                        </div>
                        <div class="type-legend-item">
                            <div class="type-legend-color" style="background-color: #B8860B;"></div>
                            <span class="type-legend-text">P√≥≈Çs≈Çodkie</span>
                        </div>
                        <div class="type-legend-item">
                            <div class="type-legend-color" style="background-color: #8B7355;"></div>
                            <span class="type-legend-text">P√≥≈Çwytrawne</span>
                        </div>
                        <div class="type-legend-item">
                            <div class="type-legend-color" style="background-color: #654321;"></div>
                            <span class="type-legend-text">Wytrawne</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Install prompt -->
    <div id="install-prompt" class="install-prompt">
        <div class="install-prompt-content">
            <div class="install-prompt-text">
                Zainstaluj aplikacjƒô na swoim telefonie!
            </div>
            <div class="install-prompt-buttons">
                <button class="install-prompt-button primary" onclick="installApp()">Instaluj</button>
                <button class="install-prompt-button secondary" onclick="dismissInstall()">P√≥≈∫niej</button>
            </div>
        </div>
    </div>

    <script>
        // Wine database
        const wineDatabase = {
            '8001935001706': {
                name: 'Chianti Classico DOCG',
                region: 'Toskania',
                type: 'Wytrawne',
                grapes: 'Sangiovese',
                color: '#8B0000'
            },
            '8000020000000': {
                name: 'Prosecco DOC',
                region: 'Veneto',
                type: 'Wytrawne',
                grapes: 'Glera',
                color: '#F0E68C'
            },
            '8002915001234': {
                name: 'Moscato d\'Asti DOCG',
                region: 'Piemont',
                type: 'S≈Çodkie',
                grapes: 'Moscato Bianco',
                color: '#FFD700'
            },
            '8003120001111': {
                name: 'Lambrusco',
                region: 'Emilia-Romagna',
                type: 'P√≥≈Çs≈Çodkie',
                grapes: 'Lambrusco',
                color: '#C41E3A'
            },
            '8004567001234': {
                name: 'Soave DOC',
                region: 'Veneto',
                type: 'P√≥≈Çwytrawne',
                grapes: 'Garganega',
                color: '#F5DEB3'
            },
            '8005678901234': {
                name: 'Amarone della Valpolicella',
                region: 'Veneto',
                type: 'Wytrawne',
                grapes: 'Corvina, Rondinella',
                color: '#4B0082'
            },
            '8006789012345': {
                name: 'Barbera d\'Alba',
                region: 'Piemont',
                type: 'Wytrawne',
                grapes: 'Barbera',
                color: '#800020'
            },
            '8007890123456': {
                name: 'Recioto della Valpolicella',
                region: 'Veneto',
                type: 'S≈Çodkie',
                grapes: 'Corvina, Rondinella',
                color: '#722F37'
            }
        };

        let deferredPrompt;
        let scannerRunning = false;

        // Type colors
        function getTypeColor(type) {
            const colors = {
                'S≈Çodkie': '#D4AF37',
                'P√≥≈Çs≈Çodkie': '#B8860B',
                'P√≥≈Çwytrawne': '#8B7355',
                'Wytrawne': '#654321'
            };
            return colors[type] || '#8B4513';
        }

        // Show/hide views
        function showView(viewId) {
            document.querySelectorAll('.content').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById(viewId).classList.add('active');
        }

        // Toggle info
        function toggleInfo() {
            const infoBox = document.getElementById('info-box');
            infoBox.classList.toggle('active');
        }

        // Populate sample codes
        function populateSampleCodes() {
            const container = document.getElementById('sample-codes');
            const codes = Object.keys(wineDatabase).slice(0, 4);
            
            container.innerHTML = codes.map((code, idx) => `
                <button class="sample-code" onclick="searchByCode('${code}')">
                    <div class="sample-code-label">Przyk≈Çad ${idx + 1}</div>
                    <div class="sample-code-number">${code}</div>
                    <div class="sample-code-name">${wineDatabase[code].name}</div>
                </button>
            `).join('');
        }

        // Start scanner
        async function startScanner() {
            if (scannerRunning) return;
            
            // First, request camera permission explicitly
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } 
                });
                // Stop the test stream
                stream.getTracks().forEach(track => track.stop());
            } catch (err) {
                console.error('Camera permission error:', err);
                alert('Brak dostƒôpu do kamery!\n\nUpewnij siƒô, ≈ºe:\n1. Przyzna≈Çe≈õ uprawnienia do kamery\n2. ≈ªadna inna aplikacja nie u≈ºywa kamery\n3. Strona jest otwarta przez HTTPS\n\nSpr√≥buj rƒôcznego wprowadzania kodu.');
                return;
            }
            
            showView('scanner-view');
            scannerRunning = true;

            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#interactive'),
                    constraints: {
                        facingMode: "environment",
                        aspectRatio: { min: 1, max: 2 },
                        width: { min: 640, ideal: 1280, max: 1920 },
                        height: { min: 480, ideal: 720, max: 1080 }
                    },
                    area: {
                        top: "25%",
                        right: "10%",
                        left: "10%",
                        bottom: "25%"
                    }
                },
                decoder: {
                    readers: [
                        "ean_reader",
                        "ean_8_reader",
                        "code_128_reader",
                        "code_39_reader",
                        "code_39_vin_reader",
                        "upc_reader",
                        "upc_e_reader",
                        "i2of5_reader"
                    ],
                    debug: {
                        drawBoundingBox: true,
                        showFrequency: true,
                        drawScanline: true,
                        showPattern: true
                    },
                    multiple: false
                },
                locate: true,
                locator: {
                    patchSize: "large",
                    halfSample: false
                },
                numOfWorkers: 4,
                frequency: 5,
                debug: false
            }, function(err) {
                if (err) {
                    console.error('Quagga init error:', err);
                    alert('B≈ÇƒÖd inicjalizacji skanera:\n' + err.message + '\n\nSpr√≥buj rƒôcznego wprowadzania kodu.');
                    showView('home-view');
                    scannerRunning = false;
                    return;
                }
                console.log('Scanner initialized successfully');
                Quagga.start();
            });

            // Visual feedback on processing
            let lastDetectionAttempt = 0;
            Quagga.onProcessed(function(result) {
                const now = Date.now();
                if (now - lastDetectionAttempt > 100) {
                    lastDetectionAttempt = now;
                    
                    var drawingCtx = Quagga.canvas.ctx.overlay;
                    var drawingCanvas = Quagga.canvas.dom.overlay;

                    if (result) {
                        if (result.boxes) {
                            drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute("width")), parseInt(drawingCanvas.getAttribute("height")));
                            result.boxes.filter(function (box) {
                                return box !== result.box;
                            }).forEach(function (box) {
                                Quagga.ImageDebug.drawPath(box, {x: 0, y: 1}, drawingCtx, {color: "rgba(251, 191, 36, 0.3)", lineWidth: 2});
                            });
                        }

                        if (result.box) {
                            Quagga.ImageDebug.drawPath(result.box, {x: 0, y: 1}, drawingCtx, {color: "#fbbf24", lineWidth: 3});
                        }

                        if (result.codeResult && result.codeResult.code) {
                            const code = result.codeResult.code;
                            drawingCtx.font = "20px Arial";
                            drawingCtx.fillStyle = "#4ade80";
                            drawingCtx.fillText(code, 10, 30);
                        }
                    }
                }
            });

            let detectionCount = {};
            Quagga.onDetected(function(result) {
                const code = result.codeResult.code;
                console.log('Detected code:', code);
                
                // Count detections to avoid false positives
                if (!detectionCount[code]) {
                    detectionCount[code] = 0;
                }
                detectionCount[code]++;
                
                // If detected 3 times in a row, accept it
                if (detectionCount[code] >= 2) {
                    console.log('Code confirmed:', code);
                    
                    if (wineDatabase[code]) {
                        stopScanner();
                        displayWine(code);
                    } else {
                        // Show detected code even if not in database
                        const scannerInfo = document.querySelector('.scanner-info');
                        scannerInfo.innerHTML = `Wykryto kod: ${code}<br><small>Nie ma w bazie danych. Spr√≥buj ponownie.</small>`;
                        scannerInfo.style.background = 'linear-gradient(to top, rgba(127, 29, 29, 0.8), transparent)';
                        
                        setTimeout(() => {
                            scannerInfo.innerHTML = 'Ustaw kod kreskowy w ramce';
                            scannerInfo.style.background = 'linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent)';
                            detectionCount = {};
                        }, 2000);
                    }
                }
            });
        }

        // Stop scanner
        function stopScanner() {
            if (scannerRunning) {
                Quagga.stop();
                scannerRunning = false;
            }
            showView('home-view');
        }

        // Test detection (for debugging)
        function testDetection() {
            const codes = Object.keys(wineDatabase);
            const randomCode = codes[Math.floor(Math.random() * codes.length)];
            stopScanner();
            displayWine(randomCode);
        }

        // Manual search
        function searchManual() {
            const input = document.getElementById('manual-input');
            const code = input.value.trim();
            
            if (wineDatabase[code]) {
                displayWine(code);
                input.value = '';
            } else {
                alert('Kod kreskowy nie zosta≈Ç znaleziony w bazie danych');
            }
        }

        // Search by code (from sample)
        function searchByCode(code) {
            displayWine(code);
        }

        // Display wine
        function displayWine(barcode) {
            const wine = wineDatabase[barcode];
            const typeColor = getTypeColor(wine.type);
            
            const card = document.getElementById('wine-card');
            card.style.borderColor = typeColor + '60';
            
            card.innerHTML = `
                <div class="wine-card-glow" style="background: radial-gradient(circle at top right, ${wine.color}, transparent 70%);"></div>
                
                <div style="position: relative; z-index: 10;">
                    <div class="wine-bottle-icon">
                        <svg style="color: ${wine.color}; width: 80px; height: 80px;" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
                        </svg>
                    </div>

                    <h2 class="wine-name">${wine.name}</h2>

                    <div class="wine-region">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                        </svg>
                        <span class="wine-region-text">${wine.region}</span>
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                        </svg>
                    </div>

                    <div class="wine-type-badge">
                        <div class="wine-type-badge-inner" style="
                            border-color: ${typeColor};
                            background: linear-gradient(135deg, ${typeColor}20, ${typeColor}10);
                            box-shadow: 0 0 30px ${typeColor}40;
                            color: ${typeColor};
                        ">
                            ${wine.type.toUpperCase()}
                        </div>
                    </div>

                    <div class="wine-details">
                        <div class="wine-detail">
                            <div class="wine-detail-label">Szczepy</div>
                            <div class="wine-detail-value">${wine.grapes}</div>
                        </div>
                        <div class="wine-detail">
                            <div class="wine-detail-label">Kod</div>
                            <div class="wine-detail-value barcode">${barcode}</div>
                        </div>
                    </div>

                    <button class="new-scan-button" onclick="showView('home-view')">
                        Skanuj kolejne wino
                    </button>
                </div>
            `;
            
            showView('result-view');
        }

        // PWA Install
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install prompt after 3 seconds
            setTimeout(() => {
                document.getElementById('install-prompt').classList.add('active');
            }, 3000);
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                    dismissInstall();
                });
            }
        }

        function dismissInstall() {
            document.getElementById('install-prompt').classList.remove('active');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            populateSampleCodes();
            
            // Check if HTTPS (required for camera)
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                const warning = document.createElement('div');
                warning.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: rgba(220, 38, 38, 0.95); color: white; padding: 12px; text-align: center; z-index: 9999; font-size: 14px;';
                warning.innerHTML = '‚ö†Ô∏è UWAGA: Strona nie u≈ºywa HTTPS! Kamera mo≈ºe nie dzia≈Çaƒá. Wgraj na GitHub Pages.';
                document.body.appendChild(warning);
            }
            
            // Check camera permission
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.permissions.query({ name: 'camera' }).then(function(result) {
                    if (result.state === 'denied') {
                        const warning = document.createElement('div');
                        warning.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: rgba(220, 38, 38, 0.95); color: white; padding: 12px; text-align: center; z-index: 9999; font-size: 14px;';
                        warning.innerHTML = '‚ö†Ô∏è Dostƒôp do kamery zablokowany! W≈ÇƒÖcz w ustawieniach przeglƒÖdarki.';
                        document.body.appendChild(warning);
                    }
                }).catch(function(err) {
                    console.log('Permission query not supported:', err);
                });
            }
        });

        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(() => {
                    console.log('Service worker registration skipped');
                });
            });
        }
    </script>
</body>
</html>