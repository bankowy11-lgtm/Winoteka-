<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Winoteka - Profesjonalna aplikacja do skanowania kodów kreskowych win">
    <meta name="theme-color" content="#2C1810">
    <title>Winoteka - Skanuj kod kreskowy wina</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html5-qrcode for reliable barcode scanning -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Cormorant Garamond', serif;
        }
        
        #reader {
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid #10B981;
        }
        
        #reader video {
            border-radius: 12px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // Ikony SVG
        const Wine = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M8 22h8"/>
                <path d="M12 15v7"/>
                <path d="M12 15c3.5 0 6-2 6-5V3H6v7c0 3 2.5 5 6 5z"/>
            </svg>
        );

        const Loader2 = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
        );

        const Heart = ({ size = 24, filled = false, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
            </svg>
        );

        const History = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
                <path d="M12 7v5l4 2"/>
            </svg>
        );

        const Share2 = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <path d="m8.59 13.51 6.83 3.98"/>
                <path d="m15.41 6.51-6.82 3.98"/>
            </svg>
        );

        const Download = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" x2="12" y1="15" y2="3"/>
            </svg>
        );

        const Trash2 = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M3 6h18"/>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                <line x1="10" x2="10" y1="11" y2="17"/>
                <line x1="14" x2="14" y1="11" y2="17"/>
            </svg>
        );

        const Star = ({ size = 24, filled = false, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
        );

        const Scan = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M3 7V5a2 2 0 0 1 2-2h2"/>
                <path d="M17 3h2a2 2 0 0 1 2 2v2"/>
                <path d="M21 17v2a2 2 0 0 1-2 2h-2"/>
                <path d="M7 21H5a2 2 0 0 1-2-2v-2"/>
                <path d="M7 12h10"/>
            </svg>
        );

        const Edit = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );

        const AlertCircle = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
        );

        const Info = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4"/>
                <path d="M12 8h.01"/>
            </svg>
        );

        // Toast notification
        const Toast = ({ message, type = 'success', onClose }) => {
          useEffect(() => {
            const timer = setTimeout(onClose, 3000);
            return () => clearTimeout(timer);
          }, []);

          return (
            <div style={{
              position: 'fixed',
              top: '2rem',
              right: '2rem',
              background: type === 'success' ? 'rgba(16, 185, 129, 0.95)' : 'rgba(239, 68, 68, 0.95)',
              color: '#FFF',
              padding: '1rem 1.5rem',
              borderRadius: '10px',
              boxShadow: '0 10px 30px rgba(0,0,0,0.3)',
              zIndex: 10000,
              animation: 'slideIn 0.3s ease-out',
              fontWeight: 600,
              maxWidth: '300px'
            }}>
              {message}
            </div>
          );
        };

        const WineApp = () => {
          const [scanning, setScanning] = useState(false);
          const [barcode, setBarcode] = useState(null);
          const [result, setResult] = useState(null);
          const [error, setError] = useState(null);
          const [analyzing, setAnalyzing] = useState(false);
          const [history, setHistory] = useState([]);
          const [favorites, setFavorites] = useState([]);
          const [showHistory, setShowHistory] = useState(false);
          const [showFavorites, setShowFavorites] = useState(false);
          const [manualEntry, setManualEntry] = useState(false);
          const [manualCode, setManualCode] = useState('');
          const [rating, setRating] = useState(0);
          const [toast, setToast] = useState(null);
          const [cameraPermission, setCameraPermission] = useState('unknown');
          
          const html5QrCodeRef = useRef(null);

          useEffect(() => {
            const savedHistory = localStorage.getItem('wineHistory');
            const savedFavorites = localStorage.getItem('wineFavorites');
            
            if (savedHistory) setHistory(JSON.parse(savedHistory));
            if (savedFavorites) setFavorites(JSON.parse(savedFavorites));

            checkCameraPermissions();
          }, []);

          const showToast = (message, type = 'success') => {
            setToast({ message, type });
          };

          const checkCameraPermissions = async () => {
            try {
              if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                setCameraPermission('unavailable');
                return;
              }

              if (navigator.permissions && navigator.permissions.query) {
                try {
                  const result = await navigator.permissions.query({ name: 'camera' });
                  setCameraPermission(result.state);
                  
                  result.onchange = () => {
                    setCameraPermission(result.state);
                  };
                } catch (err) {
                  setCameraPermission('prompt');
                }
              } else {
                setCameraPermission('prompt');
              }
            } catch (err) {
              console.error('Error checking camera permissions:', err);
              setCameraPermission('unknown');
            }
          };

          const requestCameraPermission = async () => {
            try {
              const stream = await navigator.mediaDevices.getUserMedia({ video: true });
              stream.getTracks().forEach(track => track.stop());
              setCameraPermission('granted');
              return true;
            } catch (err) {
              console.error('Camera permission denied:', err);
              setCameraPermission('denied');
              
              if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                setError('Odmówiono dostępu do kamery. Zezwól na dostęp w ustawieniach przeglądarki.');
              } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
                setError('Nie znaleziono kamery. Upewnij się, że urządzenie ma kamerę.');
              } else if (err.name === 'NotReadableError' || err.name === 'TrackStartError') {
                setError('Kamera jest używana przez inną aplikację.');
              } else {
                setError('Nie udało się uzyskać dostępu do kamery: ' + err.message);
              }
              
              showToast('Nie można uruchomić kamery', 'error');
              return false;
            }
          };

          const reset = () => {
            setScanning(false);
            setBarcode(null);
            setResult(null);
            setError(null);
            setAnalyzing(false);
            setManualEntry(false);
            setManualCode('');
            setRating(0);
          };

          const startScanning = async () => {
            if (cameraPermission === 'unavailable') {
              setError('Twoja przeglądarka nie obsługuje dostępu do kamery. Użyj wprowadzania ręcznego.');
              showToast('Kamera niedostępna', 'error');
              setManualEntry(true);
              return;
            }

            if (cameraPermission !== 'granted') {
              const granted = await requestCameraPermission();
              if (!granted) {
                setManualEntry(true);
                return;
              }
            }

            setScanning(true);
            setError(null);
            setBarcode(null);
            setResult(null);

            try {
              html5QrCodeRef.current = new Html5Qrcode("reader");
              
              const config = { 
                fps: 10,
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0,
                formatsToSupport: [
                  Html5QrcodeSupportedFormats.EAN_13,
                  Html5QrcodeSupportedFormats.EAN_8,
                  Html5QrcodeSupportedFormats.UPC_A,
                  Html5QrcodeSupportedFormats.UPC_E,
                  Html5QrcodeSupportedFormats.CODE_128,
                  Html5QrcodeSupportedFormats.CODE_39
                ]
              };

              await html5QrCodeRef.current.start(
                { facingMode: "environment" },
                config,
                (decodedText, decodedResult) => {
                  setBarcode(decodedText);
                  stopScanning();
                  showToast('Kod zeskanowany: ' + decodedText);
                  analyzeBarcode(decodedText);
                },
                (errorMessage) => {
                  // Ignoruj błędy skanowania - czekamy na poprawny odczyt
                }
              );
            } catch (err) {
              console.error('Błąd uruchomienia skanera:', err);
              
              let errorMsg = 'Nie udało się uruchomić kamery. ';
              if (err.name === 'NotAllowedError') {
                errorMsg += 'Odmówiono dostępu do kamery. Sprawdź uprawnienia w ustawieniach przeglądarki.';
              } else if (err.name === 'NotFoundError') {
                errorMsg += 'Nie znaleziono kamery.';
              } else if (err.name === 'NotReadableError') {
                errorMsg += 'Kamera jest używana przez inną aplikację.';
              } else {
                errorMsg += 'Spróbuj wprowadzić kod ręcznie.';
              }
              
              setError(errorMsg);
              setScanning(false);
              showToast('Błąd kamery - użyj wprowadzania ręcznego', 'error');
              setManualEntry(true);
            }
          };

          const stopScanning = async () => {
            if (html5QrCodeRef.current) {
              try {
                await html5QrCodeRef.current.stop();
                html5QrCodeRef.current = null;
              } catch (err) {
                console.error('Błąd zatrzymania skanera:', err);
              }
            }
            setScanning(false);
          };

          const analyzeBarcode = async (code) => {
            setAnalyzing(true);
            setError(null);

            try {
              const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  model: 'claude-sonnet-4-20250514',
                  max_tokens: 1500,
                  messages: [
                    {
                      role: 'user',
                      content: `Wyszukaj informacje o winie o kodzie kreskowym: ${code}

Podaj informacje w formacie JSON (odpowiedz TYLKO JSONem, bez żadnego tekstu przed lub po):

{
  "nazwa": "pełna nazwa wina",
  "producent": "producent/winnica",
  "kraj": "kraj pochodzenia",
  "region": "region winny",
  "rocznik": "rocznik (jeśli znany, w przeciwnym razie 'N/V' lub 'Brak danych')",
  "slodosc": "wytrawne/półwytrawne/półsłodkie/słodkie",
  "typ": "czerwone/białe/różowe/musujące",
  "szczepy": "szczepy winorośli (jeśli znane)",
  "alkohol": "zawartość alkoholu (jeśli znana)",
  "szczegoly": "charakterystyka smakowa i zapachowa (3-4 zdania)",
  "zalecenia": "z czym podawać, temperatura serwowania",
  "cena_szacunkowa": "przybliżona cena w PLN (zakres)"
}

Jeśli nie znasz tego konkretnego wina, spróbuj określić na podstawie kodu producenta i typu. Jeśli to niemożliwe:
{
  "error": "Nie znaleziono wina o kodzie ${code}. Może to być wino lokalne lub kod jest nieprawidłowy. Spróbuj zeskanować ponownie lub wprowadzić kod ręcznie."
}`
                    }
                  ]
                })
              });

              const data = await response.json();
              const content = data.content[0].text;
              const cleanJson = content.replace(/```json|```/g, '').trim();
              const wineData = JSON.parse(cleanJson);

              if (wineData.error) {
                setError(wineData.error);
                showToast('Nie rozpoznano wina', 'error');
              } else {
                const wineEntry = {
                  ...wineData,
                  barcode: code,
                  timestamp: new Date().toISOString(),
                  id: Date.now()
                };

                setResult(wineEntry);

                const newHistory = [wineEntry, ...history].slice(0, 20);
                setHistory(newHistory);
                localStorage.setItem('wineHistory', JSON.stringify(newHistory));

                showToast('Wino rozpoznane!');
              }
            } catch (err) {
              console.error('Błąd analizy:', err);
              setError('Nie udało się przeanalizować kodu. Spróbuj ponownie.');
              showToast('Błąd analizy', 'error');
            } finally {
              setAnalyzing(false);
            }
          };

          const handleManualSubmit = () => {
            if (manualCode.length >= 8) {
              setManualEntry(false);
              setBarcode(manualCode);
              showToast('Kod wprowadzony: ' + manualCode);
              analyzeBarcode(manualCode);
            } else {
              showToast('Kod musi mieć minimum 8 cyfr', 'error');
            }
          };

          const toggleFavorite = (wine) => {
            const isFavorite = favorites.some(f => f.id === wine.id);
            let newFavorites;
            
            if (isFavorite) {
              newFavorites = favorites.filter(f => f.id !== wine.id);
              showToast('Usunięto z ulubionych');
            } else {
              newFavorites = [...favorites, { ...wine, rating }];
              showToast('Dodano do ulubionych');
            }
            
            setFavorites(newFavorites);
            localStorage.setItem('wineFavorites', JSON.stringify(newFavorites));
          };

          const deleteFromHistory = (id) => {
            const newHistory = history.filter(h => h.id !== id);
            setHistory(newHistory);
            localStorage.setItem('wineHistory', JSON.stringify(newHistory));
            showToast('Usunięto z historii');
          };

          const shareWine = async (wine) => {
            const shareText = `${wine.nazwa}\n${wine.producent}\n${wine.typ} - ${wine.slodosc}\nKraj: ${wine.kraj}\nKod: ${wine.barcode}`;
            
            if (navigator.share) {
              try {
                await navigator.share({
                  title: 'Winoteka - ' + wine.nazwa,
                  text: shareText,
                });
                showToast('Udostępniono');
              } catch (err) {
                if (err.name !== 'AbortError') {
                  navigator.clipboard.writeText(shareText);
                  showToast('Skopiowano do schowka');
                }
              }
            } else {
              navigator.clipboard.writeText(shareText);
              showToast('Skopiowano do schowka');
            }
          };

          const exportData = (format) => {
            let content, filename, mimeType;

            if (format === 'json') {
              content = JSON.stringify({ history, favorites }, null, 2);
              filename = 'winoteka-export.json';
              mimeType = 'application/json';
            } else if (format === 'csv') {
              const csvRows = [
                ['Nazwa', 'Producent', 'Kraj', 'Region', 'Typ', 'Słodkość', 'Kod', 'Data'].join(','),
                ...history.map(w => [
                  w.nazwa, w.producent, w.kraj, w.region, w.typ, w.slodosc, w.barcode,
                  new Date(w.timestamp).toLocaleDateString('pl-PL')
                ].map(v => `"${v}"`).join(','))
              ];
              content = csvRows.join('\n');
              filename = 'winoteka-export.csv';
              mimeType = 'text/csv';
            }

            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast(`Wyeksportowano jako ${format.toUpperCase()}`);
          };

          return (
            <div style={{
              minHeight: '100vh',
              background: 'linear-gradient(135deg, #2C1810 0%, #4A2C1B 50%, #3D1E12 100%)',
              padding: '2rem 1rem',
              fontFamily: '"Cormorant Garamond", serif'
            }}>
              {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}

              <div style={{ maxWidth: '800px', margin: '0 auto' }}>
                {/* Header */}
                <div style={{
                  textAlign: 'center', marginBottom: '2rem',
                  animation: 'fadeInDown 0.8s ease-out'
                }}>
                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '1rem', marginBottom: '1rem' }}>
                    <Wine size={64} style={{ color: '#D4A574' }} />
                    <h1 style={{
                      fontSize: '4rem', fontWeight: 700, margin: 0,
                      background: 'linear-gradient(135deg, #F5E6D3 0%, #D4A574 50%, #C19A6B 100%)',
                      WebkitBackgroundClip: 'text',
                      WebkitTextFillColor: 'transparent',
                      textShadow: '2px 2px 4px rgba(0,0,0,0.3)'
                    }}>
                      Winoteka
                    </h1>
                  </div>
                  <p style={{ fontSize: '1.4rem', color: '#E5D5C3', margin: 0, fontStyle: 'italic' }}>
                    Odkryj historię każdej butelki
                  </p>
                </div>

                {/* Navigation */}
                {!scanning && !result && !analyzing && (
                  <div style={{
                    display: 'flex', gap: '1rem', marginBottom: '2rem',
                    animation: 'fadeIn 0.5s ease-out'
                  }}>
                    <button
                      onClick={() => { setShowHistory(!showHistory); setShowFavorites(false); }}
                      style={{
                        flex: 1,
                        background: showHistory ? 'rgba(212, 165, 116, 0.3)' : 'rgba(60, 40, 30, 0.6)',
                        border: showHistory ? '2px solid #D4A574' : '1px solid rgba(212, 165, 116, 0.3)',
                        borderRadius: '12px',
                        padding: '1rem',
                        color: '#F5E6D3',
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem',
                        fontSize: '1.1rem',
                        fontFamily: '"Cormorant Garamond", serif',
                        fontWeight: 600
                      }}
                    >
                      <History size={24} />
                      Historia ({history.length})
                    </button>
                    <button
                      onClick={() => { setShowFavorites(!showFavorites); setShowHistory(false); }}
                      style={{
                        flex: 1,
                        background: showFavorites ? 'rgba(212, 165, 116, 0.3)' : 'rgba(60, 40, 30, 0.6)',
                        border: showFavorites ? '2px solid #D4A574' : '1px solid rgba(212, 165, 116, 0.3)',
                        borderRadius: '12px',
                        padding: '1rem',
                        color: '#F5E6D3',
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem',
                        fontSize: '1.1rem',
                        fontFamily: '"Cormorant Garamond", serif',
                        fontWeight: 600
                      }}
                    >
                      <Heart size={24} />
                      Ulubione ({favorites.length})
                    </button>
                  </div>
                )}

                {/* History View */}
                {showHistory && !scanning && (
                  <div style={{ animation: 'fadeInUp 0.5s ease-out' }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      marginBottom: '1.5rem'
                    }}>
                      <h2 style={{ fontSize: '2rem', color: '#D4A574', margin: 0 }}>
                        Historia skanowań
                      </h2>
                      {history.length > 0 && (
                        <div style={{ display: 'flex', gap: '0.5rem' }}>
                          <button
                            onClick={() => exportData('json')}
                            style={{
                              background: 'rgba(60, 40, 30, 0.6)',
                              border: '1px solid rgba(212, 165, 116, 0.3)',
                              borderRadius: '8px',
                              padding: '0.5rem',
                              color: '#D4A574',
                              cursor: 'pointer'
                            }}
                            title="Eksportuj JSON"
                          >
                            <Download size={20} />
                          </button>
                          <button
                            onClick={() => exportData('csv')}
                            style={{
                              background: 'rgba(60, 40, 30, 0.6)',
                              border: '1px solid rgba(212, 165, 116, 0.3)',
                              borderRadius: '8px',
                              padding: '0.5rem 1rem',
                              color: '#D4A574',
                              cursor: 'pointer',
                              fontFamily: '"Cormorant Garamond", serif',
                              fontSize: '0.9rem',
                              fontWeight: 600
                            }}
                            title="Eksportuj CSV"
                          >
                            CSV
                          </button>
                        </div>
                      )}
                    </div>

                    {history.length === 0 ? (
                      <div style={{
                        textAlign: 'center',
                        padding: '3rem',
                        background: 'rgba(60, 40, 30, 0.4)',
                        borderRadius: '15px',
                        border: '1px solid rgba(212, 165, 116, 0.2)'
                      }}>
                        <History size={64} style={{ color: '#D4A574', opacity: 0.5, marginBottom: '1rem' }} />
                        <p style={{ fontSize: '1.3rem', color: '#D4A574', margin: 0 }}>
                          Brak historii skanowań
                        </p>
                      </div>
                    ) : (
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                        {history.map((wine) => (
                          <div
                            key={wine.id}
                            style={{
                              background: 'rgba(60, 40, 30, 0.6)',
                              border: '1px solid rgba(212, 165, 116, 0.3)',
                              borderRadius: '15px',
                              padding: '1.5rem'
                            }}
                          >
                            <div style={{
                              display: 'flex',
                              justifyContent: 'space-between',
                              alignItems: 'flex-start',
                              marginBottom: '1rem'
                            }}>
                              <div style={{ flex: 1 }}>
                                <h3 style={{
                                  fontSize: '1.5rem',
                                  color: '#F5E6D3',
                                  margin: '0 0 0.5rem 0',
                                  fontWeight: 600
                                }}>
                                  {wine.nazwa}
                                </h3>
                                <p style={{
                                  fontSize: '1.1rem',
                                  color: '#D4A574',
                                  margin: '0 0 0.3rem 0'
                                }}>
                                  {wine.producent}
                                </p>
                                <p style={{
                                  fontSize: '0.9rem',
                                  color: '#B8A490',
                                  margin: 0
                                }}>
                                  {new Date(wine.timestamp).toLocaleString('pl-PL')}
                                </p>
                              </div>
                              <div style={{ display: 'flex', gap: '0.5rem' }}>
                                <button
                                  onClick={() => shareWine(wine)}
                                  style={{
                                    background: 'rgba(212, 165, 116, 0.2)',
                                    border: '1px solid rgba(212, 165, 116, 0.4)',
                                    borderRadius: '8px',
                                    padding: '0.5rem',
                                    color: '#D4A574',
                                    cursor: 'pointer'
                                  }}
                                >
                                  <Share2 size={20} />
                                </button>
                                <button
                                  onClick={() => deleteFromHistory(wine.id)}
                                  style={{
                                    background: 'rgba(139, 0, 0, 0.3)',
                                    border: '1px solid rgba(255, 100, 100, 0.4)',
                                    borderRadius: '8px',
                                    padding: '0.5rem',
                                    color: '#FFB3B3',
                                    cursor: 'pointer'
                                  }}
                                >
                                  <Trash2 size={20} />
                                </button>
                              </div>
                            </div>
                            <div style={{
                              display: 'grid',
                              gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))',
                              gap: '0.5rem'
                            }}>
                              <div style={{
                                background: 'rgba(139, 69, 19, 0.3)',
                                padding: '0.5rem',
                                borderRadius: '8px',
                                textAlign: 'center'
                              }}>
                                <p style={{ fontSize: '0.8rem', color: '#D4A574', margin: '0 0 0.2rem 0' }}>
                                  Typ
                                </p>
                                <p style={{ fontSize: '1rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                  {wine.typ}
                                </p>
                              </div>
                              <div style={{
                                background: 'rgba(139, 69, 19, 0.3)',
                                padding: '0.5rem',
                                borderRadius: '8px',
                                textAlign: 'center'
                              }}>
                                <p style={{ fontSize: '0.8rem', color: '#D4A574', margin: '0 0 0.2rem 0' }}>
                                  Kraj
                                </p>
                                <p style={{ fontSize: '1rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                  {wine.kraj}
                                </p>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}

                    <button
                      onClick={() => setShowHistory(false)}
                      style={{
                        width: '100%',
                        marginTop: '1.5rem',
                        background: 'linear-gradient(135deg, #8B4513 0%, #A0522D 100%)',
                        color: '#FFF',
                        border: 'none',
                        borderRadius: '12px',
                        padding: '1rem 2rem',
                        fontSize: '1.2rem',
                        fontWeight: 600,
                        cursor: 'pointer',
                        fontFamily: '"Cormorant Garamond", serif'
                      }}
                    >
                      Powrót
                    </button>
                  </div>
                )}

                {/* Favorites View */}
                {showFavorites && !scanning && (
                  <div style={{ animation: 'fadeInUp 0.5s ease-out' }}>
                    <h2 style={{
                      fontSize: '2rem',
                      color: '#D4A574',
                      marginBottom: '1.5rem'
                    }}>
                      Ulubione wina
                    </h2>

                    {favorites.length === 0 ? (
                      <div style={{
                        textAlign: 'center',
                        padding: '3rem',
                        background: 'rgba(60, 40, 30, 0.4)',
                        borderRadius: '15px',
                        border: '1px solid rgba(212, 165, 116, 0.2)'
                      }}>
                        <Heart size={64} style={{ color: '#D4A574', opacity: 0.5, marginBottom: '1rem' }} />
                        <p style={{ fontSize: '1.3rem', color: '#D4A574', margin: 0 }}>
                          Brak ulubionych win
                        </p>
                      </div>
                    ) : (
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                        {favorites.map((wine) => (
                          <div
                            key={wine.id}
                            style={{
                              background: 'rgba(60, 40, 30, 0.6)',
                              border: '2px solid rgba(212, 165, 116, 0.5)',
                              borderRadius: '15px',
                              padding: '1.5rem'
                            }}
                          >
                            <div style={{
                              display: 'flex',
                              justifyContent: 'space-between',
                              alignItems: 'flex-start',
                              marginBottom: '1rem'
                            }}>
                              <div style={{ flex: 1 }}>
                                <h3 style={{
                                  fontSize: '1.5rem',
                                  color: '#F5E6D3',
                                  margin: '0 0 0.5rem 0',
                                  fontWeight: 600
                                }}>
                                  {wine.nazwa}
                                </h3>
                                <p style={{
                                  fontSize: '1.1rem',
                                  color: '#D4A574',
                                  margin: '0 0 0.5rem 0'
                                }}>
                                  {wine.producent}
                                </p>
                                {wine.rating > 0 && (
                                  <div style={{ display: 'flex', gap: '0.2rem' }}>
                                    {[...Array(5)].map((_, i) => (
                                      <Star
                                        key={i}
                                        size={20}
                                        filled={i < wine.rating}
                                        style={{ color: '#FFD700' }}
                                      />
                                    ))}
                                  </div>
                                )}
                              </div>
                              <button
                                onClick={() => toggleFavorite(wine)}
                                style={{
                                  background: 'rgba(139, 0, 0, 0.3)',
                                  border: '1px solid rgba(255, 100, 100, 0.4)',
                                  borderRadius: '8px',
                                  padding: '0.5rem',
                                  color: '#FFB3B3',
                                  cursor: 'pointer'
                                }}
                              >
                                <Trash2 size={20} />
                              </button>
                            </div>
                            {wine.szczegoly && (
                              <p style={{
                                fontSize: '1rem',
                                color: '#E5D5C3',
                                margin: '0 0 0.5rem 0',
                                lineHeight: '1.5'
                              }}>
                                {wine.szczegoly}
                              </p>
                            )}
                          </div>
                        ))}
                      </div>
                    )}

                    <button
                      onClick={() => setShowFavorites(false)}
                      style={{
                        width: '100%',
                        marginTop: '1.5rem',
                        background: 'linear-gradient(135deg, #8B4513 0%, #A0522D 100%)',
                        color: '#FFF',
                        border: 'none',
                        borderRadius: '12px',
                        padding: '1rem 2rem',
                        fontSize: '1.2rem',
                        fontWeight: 600,
                        cursor: 'pointer',
                        fontFamily: '"Cormorant Garamond", serif'
                      }}
                    >
                      Powrót
                    </button>
                  </div>
                )}

                {/* Main Scanner View */}
                {!showHistory && !showFavorites && (
                  <div style={{ animation: 'fadeIn 0.5s ease-out' }}>
                    {/* Camera Permission Warning */}
                    {(cameraPermission === 'denied' || cameraPermission === 'unavailable') && !scanning && !result && !manualEntry && (
                      <div style={{
                        background: 'rgba(255, 165, 0, 0.2)',
                        border: '2px solid rgba(255, 165, 0, 0.5)',
                        borderRadius: '12px',
                        padding: '1.5rem',
                        marginBottom: '1.5rem',
                        display: 'flex',
                        alignItems: 'flex-start',
                        gap: '1rem'
                      }}>
                        <AlertCircle size={24} style={{ color: '#FFA500', flexShrink: 0, marginTop: '0.2rem' }} />
                        <div style={{ flex: 1 }}>
                          <h3 style={{ fontSize: '1.2rem', color: '#FFA500', margin: '0 0 0.5rem 0', fontWeight: 600 }}>
                            {cameraPermission === 'unavailable' ? 'Kamera niedostępna' : 'Brak dostępu do kamery'}
                          </h3>
                          <p style={{ fontSize: '1rem', color: '#FFD580', margin: '0 0 1rem 0', lineHeight: '1.5' }}>
                            {cameraPermission === 'unavailable' 
                              ? 'Twoja przeglądarka nie obsługuje dostępu do kamery. Użyj wprowadzania ręcznego.'
                              : 'Aby korzystać ze skanera, zezwól na dostęp do kamery w ustawieniach przeglądarki.'
                            }
                          </p>
                          <button
                            onClick={() => setManualEntry(true)}
                            style={{
                              background: 'rgba(139, 69, 19, 0.8)',
                              color: '#F5E6D3',
                              border: 'none',
                              borderRadius: '8px',
                              padding: '0.8rem 1.5rem',
                              fontSize: '1rem',
                              cursor: 'pointer',
                              fontFamily: '"Cormorant Garamond", serif',
                              fontWeight: 600
                            }}
                          >
                            Wprowadź kod ręcznie
                          </button>
                        </div>
                      </div>
                    )}

                    {!scanning && !result && !manualEntry && (
                      <div style={{
                        background: 'rgba(60, 40, 30, 0.6)',
                        borderRadius: '20px',
                        padding: '3rem',
                        textAlign: 'center',
                        border: '2px solid rgba(212, 165, 116, 0.3)',
                        animation: 'fadeInUp 0.8s ease-out'
                      }}>
                        <Scan size={80} style={{ color: '#D4A574', marginBottom: '2rem' }} />
                        <h2 style={{
                          fontSize: '2.5rem',
                          color: '#F5E6D3',
                          marginBottom: '1rem',
                          fontWeight: 600
                        }}>
                          Zeskanuj kod kreskowy
                        </h2>
                        <p style={{
                          fontSize: '1.2rem',
                          color: '#D4A574',
                          marginBottom: '2rem',
                          lineHeight: '1.6'
                        }}>
                          Użyj kamery lub wprowadź kod ręcznie
                        </p>
                        
                        <div style={{
                          display: 'flex',
                          flexDirection: 'column',
                          gap: '1rem',
                          maxWidth: '400px',
                          margin: '0 auto'
                        }}>
                          <button onClick={startScanning} style={{
                            width: '100%',
                            background: 'linear-gradient(135deg, #10B981 0%, #059669 100%)',
                            color: '#FFF',
                            border: 'none',
                            borderRadius: '12px',
                            padding: '1.2rem 2rem',
                            fontSize: '1.3rem',
                            fontWeight: 600,
                            cursor: 'pointer',
                            fontFamily: '"Cormorant Garamond", serif',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '0.8rem',
                            textTransform: 'uppercase',
                            boxShadow: '0 5px 15px rgba(16, 185, 129, 0.3)'
                          }}>
                            <Scan size={28} />
                            Uruchom skaner
                          </button>

                          <button onClick={() => setManualEntry(true)} style={{
                            width: '100%',
                            background: 'rgba(139, 69, 19, 0.6)',
                            color: '#F5E6D3',
                            border: '2px solid rgba(212, 165, 116, 0.4)',
                            borderRadius: '12px',
                            padding: '1rem 2rem',
                            fontSize: '1.2rem',
                            fontWeight: 600,
                            cursor: 'pointer',
                            fontFamily: '"Cormorant Garamond", serif',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '0.8rem'
                          }}>
                            <Edit size={24} />
                            Wprowadź kod ręcznie
                          </button>
                        </div>

                        <div style={{
                          marginTop: '2rem',
                          padding: '1.5rem',
                          background: 'rgba(139, 69, 19, 0.2)',
                          borderRadius: '12px',
                          border: '1px solid rgba(212, 165, 116, 0.2)'
                        }}>
                          <div style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '0.5rem',
                            marginBottom: '0.8rem'
                          }}>
                            <Info size={20} style={{ color: '#D4A574' }} />
                            <h3 style={{
                              fontSize: '1.1rem',
                              color: '#D4A574',
                              margin: 0,
                              fontWeight: 600
                            }}>
                              Jak to działa?
                            </h3>
                          </div>
                          <p style={{
                            fontSize: '1rem',
                            color: '#E5D5C3',
                            margin: 0,
                            lineHeight: '1.6'
                          }}>
                            Zeskanuj kod kreskowy na butelce wina, a Claude AI odnajdzie dla Ciebie szczegółowe informacje o winie, jego pochodzeniu i smaku.
                          </p>
                        </div>
                      </div>
                    )}

                    {/* Manual Entry */}
                    {manualEntry && (
                      <div style={{
                        background: 'rgba(60, 40, 30, 0.6)',
                        borderRadius: '20px',
                        padding: '2rem',
                        border: '2px solid rgba(212, 165, 116, 0.3)',
                        animation: 'fadeInUp 0.5s ease-out'
                      }}>
                        <h3 style={{
                          fontSize: '1.8rem',
                          color: '#F5E6D3',
                          marginBottom: '1.5rem',
                          textAlign: 'center'
                        }}>
                          Wprowadź kod kreskowy
                        </h3>
                        <input
                          type="text"
                          value={manualCode}
                          onChange={(e) => setManualCode(e.target.value.replace(/\D/g, ''))}
                          placeholder="np. 5901234567890"
                          style={{
                            width: '100%',
                            background: 'rgba(139, 69, 19, 0.3)',
                            border: '2px solid rgba(212, 165, 116, 0.4)',
                            borderRadius: '12px',
                            padding: '1rem',
                            fontSize: '1.5rem',
                            color: '#F5E6D3',
                            textAlign: 'center',
                            fontFamily: '"Courier New", monospace',
                            letterSpacing: '0.1em',
                            marginBottom: '1rem',
                            boxSizing: 'border-box'
                          }}
                          onKeyPress={(e) => e.key === 'Enter' && handleManualSubmit()}
                        />
                        <p style={{
                          fontSize: '0.9rem',
                          color: '#D4A574',
                          textAlign: 'center',
                          marginBottom: '1.5rem'
                        }}>
                          Minimum 8 cyfr
                        </p>
                        <div style={{ display: 'flex', gap: '1rem' }}>
                          <button
                            onClick={() => { setManualEntry(false); setManualCode(''); }}
                            style={{
                              flex: 1,
                              background: 'rgba(139, 69, 19, 0.4)',
                              color: '#F5E6D3',
                              border: '1px solid rgba(212, 165, 116, 0.3)',
                              borderRadius: '12px',
                              padding: '1rem',
                              fontSize: '1.1rem',
                              cursor: 'pointer',
                              fontFamily: '"Cormorant Garamond", serif',
                              fontWeight: 600
                            }}
                          >
                            Anuluj
                          </button>
                          <button
                            onClick={handleManualSubmit}
                            disabled={manualCode.length < 8}
                            style={{
                              flex: 1,
                              background: manualCode.length >= 8
                                ? 'linear-gradient(135deg, #10B981 0%, #059669 100%)'
                                : 'rgba(100, 100, 100, 0.3)',
                              color: '#FFF',
                              border: 'none',
                              borderRadius: '12px',
                              padding: '1rem',
                              fontSize: '1.1rem',
                              cursor: manualCode.length >= 8 ? 'pointer' : 'not-allowed',
                              fontFamily: '"Cormorant Garamond", serif',
                              fontWeight: 600,
                              opacity: manualCode.length >= 8 ? 1 : 0.5
                            }}
                          >
                            Zatwierdź
                          </button>
                        </div>
                      </div>
                    )}

                    {/* Scanner Active */}
                    {scanning && (
                      <div style={{ animation: 'fadeInUp 0.5s ease-out' }}>
                        <div id="reader" style={{ marginBottom: '1.5rem' }}></div>
                        <button onClick={stopScanning} style={{
                          width: '100%',
                          background: 'linear-gradient(135deg, #DC2626 0%, #991B1B 100%)',
                          color: '#FFF',
                          border: 'none',
                          borderRadius: '12px',
                          padding: '1rem 2rem',
                          fontSize: '1.2rem',
                          fontWeight: 600,
                          cursor: 'pointer',
                          fontFamily: '"Cormorant Garamond", serif',
                          textTransform: 'uppercase'
                        }}>
                          Zatrzymaj skanowanie
                        </button>
                      </div>
                    )}

                    {/* Results */}
                    {result && !analyzing && (
                      <div style={{
                        background: 'rgba(60, 40, 30, 0.6)',
                        borderRadius: '20px',
                        padding: '2rem',
                        border: '2px solid rgba(212, 165, 116, 0.4)',
                        animation: 'fadeInUp 0.8s ease-out'
                      }}>
                        <div style={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'flex-start',
                          marginBottom: '1.5rem'
                        }}>
                          <div style={{ flex: 1 }}>
                            <h2 style={{
                              fontSize: '2.5rem',
                              color: '#F5E6D3',
                              margin: '0 0 0.5rem 0',
                              fontWeight: 700
                            }}>
                              {result.nazwa}
                            </h2>
                            <p style={{
                              fontSize: '1.5rem',
                              color: '#D4A574',
                              margin: '0 0 0.5rem 0',
                              fontWeight: 600
                            }}>
                              {result.producent}
                            </p>
                            <p style={{
                              fontSize: '1.1rem',
                              color: '#B8A490',
                              margin: 0,
                              fontFamily: '"Courier New", monospace'
                            }}>
                              Kod: {result.barcode}
                            </p>
                          </div>
                          <button
                            onClick={() => toggleFavorite(result)}
                            style={{
                              background: favorites.some(f => f.id === result.id)
                                ? 'rgba(220, 38, 38, 0.3)'
                                : 'rgba(139, 69, 19, 0.3)',
                              border: '2px solid ' + (favorites.some(f => f.id === result.id)
                                ? 'rgba(239, 68, 68, 0.5)'
                                : 'rgba(212, 165, 116, 0.4)'),
                              borderRadius: '12px',
                              padding: '1rem',
                              cursor: 'pointer'
                            }}
                          >
                            <Heart
                              size={32}
                              filled={favorites.some(f => f.id === result.id)}
                              style={{ color: favorites.some(f => f.id === result.id) ? '#EF4444' : '#D4A574' }}
                            />
                          </button>
                        </div>

                        {!favorites.some(f => f.id === result.id) && (
                          <div style={{
                            background: 'rgba(139, 69, 19, 0.3)',
                            padding: '1rem',
                            borderRadius: '12px',
                            marginBottom: '1.5rem'
                          }}>
                            <p style={{
                              fontSize: '1rem',
                              color: '#D4A574',
                              margin: '0 0 0.5rem 0',
                              textAlign: 'center'
                            }}>
                              Oceń to wino
                            </p>
                            <div style={{
                              display: 'flex',
                              justifyContent: 'center',
                              gap: '0.5rem'
                            }}>
                              {[1, 2, 3, 4, 5].map((star) => (
                                <button
                                  key={star}
                                  onClick={() => setRating(star)}
                                  style={{
                                    background: 'none',
                                    border: 'none',
                                    cursor: 'pointer',
                                    padding: '0.2rem'
                                  }}
                                >
                                  <Star
                                    size={32}
                                    filled={star <= rating}
                                    style={{ color: '#FFD700' }}
                                  />
                                </button>
                              ))}
                            </div>
                          </div>
                        )}

                        <div style={{
                          display: 'grid',
                          gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))',
                          gap: '1rem',
                          marginBottom: '1.5rem'
                        }}>
                          {result.typ && result.typ !== 'Brak danych' && (
                            <div style={{
                              background: 'rgba(60, 40, 30, 0.6)',
                              padding: '1rem',
                              borderRadius: '10px',
                              border: '1px solid rgba(212, 165, 116, 0.2)'
                            }}>
                              <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Typ</p>
                              <p style={{ fontSize: '1.2rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                {result.typ}
                              </p>
                            </div>
                          )}

                          {result.slodosc && result.slodosc !== 'Brak danych' && (
                            <div style={{
                              background: 'rgba(60, 40, 30, 0.6)',
                              padding: '1rem',
                              borderRadius: '10px',
                              border: '1px solid rgba(212, 165, 116, 0.2)'
                            }}>
                              <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Słodkość</p>
                              <p style={{ fontSize: '1.2rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                {result.slodosc}
                              </p>
                            </div>
                          )}

                          {result.kraj && result.kraj !== 'Brak danych' && (
                            <div style={{
                              background: 'rgba(60, 40, 30, 0.6)',
                              padding: '1rem',
                              borderRadius: '10px',
                              border: '1px solid rgba(212, 165, 116, 0.2)'
                            }}>
                              <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Kraj</p>
                              <p style={{ fontSize: '1.2rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                {result.kraj}
                              </p>
                            </div>
                          )}

                          {result.region && result.region !== 'Brak danych' && (
                            <div style={{
                              background: 'rgba(60, 40, 30, 0.6)',
                              padding: '1rem',
                              borderRadius: '10px',
                              border: '1px solid rgba(212, 165, 116, 0.2)'
                            }}>
                              <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Region</p>
                              <p style={{ fontSize: '1.2rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                {result.region}
                              </p>
                            </div>
                          )}

                          {result.rocznik && result.rocznik !== 'Brak danych' && (
                            <div style={{
                              background: 'rgba(60, 40, 30, 0.6)',
                              padding: '1rem',
                              borderRadius: '10px',
                              border: '1px solid rgba(212, 165, 116, 0.2)'
                            }}>
                              <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Rocznik</p>
                              <p style={{ fontSize: '1.2rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                {result.rocznik}
                              </p>
                            </div>
                          )}

                          {result.alkohol && result.alkohol !== 'Brak danych' && (
                            <div style={{
                              background: 'rgba(60, 40, 30, 0.6)', padding: '1rem',
                              borderRadius: '10px', border: '1px solid rgba(212, 165, 116, 0.2)'
                            }}>
                              <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Alkohol</p>
                              <p style={{ fontSize: '1.2rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                {result.alkohol}
                              </p>
                            </div>
                          )}
                        </div>

                        {result.szczegoly && result.szczegoly !== 'Brak danych' && (
                          <div style={{
                            background: 'rgba(60, 40, 30, 0.6)', padding: '1.5rem',
                            borderRadius: '12px', marginBottom: '1rem',
                            border: '1px solid rgba(212, 165, 116, 0.2)'
                          }}>
                            <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.5rem 0', fontWeight: 600 }}>
                              Charakterystyka
                            </p>
                            <p style={{ fontSize: '1.1rem', color: '#E5D5C3', margin: 0, lineHeight: '1.6' }}>
                              {result.szczegoly}
                            </p>
                          </div>
                        )}

                        {result.zalecenia && result.zalecenia !== 'Brak danych' && (
                          <div style={{
                            background: 'rgba(60, 40, 30, 0.6)', padding: '1.5rem',
                            borderRadius: '12px', marginBottom: '1.5rem',
                            border: '1px solid rgba(212, 165, 116, 0.2)'
                          }}>
                            <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.5rem 0', fontWeight: 600 }}>
                              Zalecenia
                            </p>
                            <p style={{ fontSize: '1.1rem', color: '#E5D5C3', margin: 0, lineHeight: '1.6' }}>
                              {result.zalecenia}
                            </p>
                          </div>
                        )}

                        <button onClick={reset} style={{
                          width: '100%', background: 'linear-gradient(135deg, #8B4513 0%, #A0522D 100%)',
                          color: '#FFF', border: 'none', borderRadius: '12px', padding: '1rem 2rem',
                          fontSize: '1.2rem', fontWeight: 600, cursor: 'pointer',
                          fontFamily: '"Cormorant Garamond", serif', textTransform: 'uppercase'
                        }}>
                          Skanuj kolejne wino
                        </button>
                      </div>
                    )}

                    {error && !result && (
                      <div style={{
                        background: 'rgba(139, 0, 0, 0.3)', border: '1px solid rgba(255, 100, 100, 0.5)',
                        borderRadius: '10px', padding: '1.5rem', marginTop: '1rem',
                        color: '#FFB3B3', textAlign: 'center'
                      }}>
                        <p style={{ margin: '0 0 1rem 0', fontSize: '1.1rem' }}>{error}</p>
                        <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center', flexWrap: 'wrap' }}>
                          <button onClick={reset} style={{
                            background: 'rgba(139, 69, 19, 0.8)', color: '#F5E6D3',
                            border: 'none', borderRadius: '8px', padding: '0.8rem 1.5rem',
                            fontSize: '1rem', cursor: 'pointer', fontFamily: '"Cormorant Garamond", serif'
                          }}>
                            Spróbuj ponownie
                          </button>
                          <button onClick={() => setManualEntry(true)} style={{
                            background: 'rgba(139, 69, 19, 0.8)', color: '#F5E6D3',
                            border: 'none', borderRadius: '8px', padding: '0.8rem 1.5rem',
                            fontSize: '1rem', cursor: 'pointer', fontFamily: '"Cormorant Garamond", serif'
                          }}>
                            Wprowadź kod ręcznie
                          </button>
                        </div>
                      </div>
                    )}

                    {analyzing && (
                      <div style={{ textAlign: 'center', padding: '2rem' }}>
                        <Loader2 size={48} style={{ color: '#D4A574', animation: 'spin 1s linear infinite', marginBottom: '1rem' }} />
                        <p style={{ fontSize: '1.3rem', color: '#D4A574', margin: 0 }}>
                          Wyszukuję informacje...
                        </p>
                      </div>
                    )}
                  </div>
                )}

                {/* Legend */}
                {!showHistory && !showFavorites && !scanning && (
                  <div style={{
                    marginTop: '2rem', background: 'rgba(60, 40, 30, 0.6)',
                    borderRadius: '15px', padding: '1.5rem',
                    border: '1px solid rgba(212, 165, 116, 0.2)'
                  }}>
                    <h3 style={{
                      fontSize: '1.3rem', color: '#D4A574', marginBottom: '1rem',
                      textAlign: 'center', fontWeight: 600
                    }}>Skala słodkości win</h3>
                    <div style={{
                      display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem'
                    }}>
                      {[
                        { name: 'Wytrawne', color: '#8B4513', icon: '●○○○' },
                        { name: 'Półwytrawne', color: '#D4A574', icon: '●●○○' },
                        { name: 'Półsłodkie', color: '#E8B4A8', icon: '●●●○' },
                        { name: 'Słodkie', color: '#F4C2C2', icon: '●●●●' }
                      ].map((item, i) => (
                        <div key={i} style={{
                          background: item.color, padding: '0.8rem', borderRadius: '8px',
                          textAlign: 'center', border: '1px solid rgba(255,255,255,0.2)'
                        }}>
                          <p style={{ fontSize: '1rem', fontWeight: 600, color: '#FFF', margin: '0 0 0.3rem 0' }}>
                            {item.name}
                          </p>
                          <p style={{ fontSize: '1.2rem', color: '#FFF', margin: 0, letterSpacing: '0.2em' }}>
                            {item.icon}
                          </p>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Footer */}
                <div style={{
                  marginTop: '3rem', textAlign: 'center', padding: '1.5rem',
                  background: 'rgba(60, 40, 30, 0.4)', borderRadius: '12px',
                  border: '1px solid rgba(212, 165, 116, 0.2)'
                }}>
                  <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: 0, lineHeight: '1.6' }}>
                    Powered by Claude AI • Winoteka v4.1<br/>
                    © 2026 Winoteka - Odkryj świat wina
                  </p>
                </div>
              </div>

              <style>{`
                @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&display=swap');
                
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
                @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
                @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
                
                ::-webkit-scrollbar { width: 8px; }
                ::-webkit-scrollbar-track { background: rgba(60, 40, 30, 0.3); border-radius: 4px; }
                ::-webkit-scrollbar-thumb { background: rgba(212, 165, 116, 0.5); border-radius: 4px; }
                ::-webkit-scrollbar-thumb:hover { background: rgba(212, 165, 116, 0.8); }
              `}</style>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WineApp />);
    </script>
</body>
</html>
