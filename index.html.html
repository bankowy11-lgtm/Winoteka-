<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Winoteka - Profesjonalna aplikacja do skanowania kodów kreskowych win">
    <meta name="theme-color" content="#2C1810">
    <title>Winoteka - Skanuj kod kreskowy wina</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html5-qrcode for reliable barcode scanning -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Cormorant Garamond', serif;
        }
        
        #reader {
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid #10B981;
        }
        
        #reader video {
            border-radius: 12px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // Ikony
        const Wine = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M8 22h8"/>
                <path d="M12 15v7"/>
                <path d="M12 15c3.5 0 6-2 6-5V3H6v7c0 3 2.5 5 6 5z"/>
            </svg>
        );

        const Droplets = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/>
                <path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/>
            </svg>
        );

        const Info = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4"/>
                <path d="M12 8h.01"/>
            </svg>
        );

        const Loader2 = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
        );

        const X = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M18 6 6 18"/>
                <path d="m6 6 12 12"/>
            </svg>
        );

        const Heart = ({ size = 24, filled = false, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
            </svg>
        );

        const History = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
                <path d="M12 7v5l4 2"/>
            </svg>
        );

        const Share2 = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <path d="m8.59 13.51 6.83 3.98"/>
                <path d="m15.41 6.51-6.82 3.98"/>
            </svg>
        );

        const Download = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" x2="12" y1="15" y2="3"/>
            </svg>
        );

        const Trash2 = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M3 6h18"/>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                <line x1="10" x2="10" y1="11" y2="17"/>
                <line x1="14" x2="14" y1="11" y2="17"/>
            </svg>
        );

        const Star = ({ size = 24, filled = false, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
        );

        const Scan = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M3 7V5a2 2 0 0 1 2-2h2"/>
                <path d="M17 3h2a2 2 0 0 1 2 2v2"/>
                <path d="M21 17v2a2 2 0 0 1-2 2h-2"/>
                <path d="M7 21H5a2 2 0 0 1-2-2v-2"/>
                <path d="M7 12h10"/>
            </svg>
        );

        const Edit = ({ size = 24, style = {} }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );

        // Toast notification
        const Toast = ({ message, type = 'success', onClose }) => {
          useEffect(() => {
            const timer = setTimeout(onClose, 3000);
            return () => clearTimeout(timer);
          }, []);

          return (
            <div style={{
              position: 'fixed',
              top: '2rem',
              right: '2rem',
              background: type === 'success' ? 'rgba(16, 185, 129, 0.95)' : 'rgba(220, 38, 38, 0.95)',
              color: '#FFF',
              padding: '1rem 1.5rem',
              borderRadius: '12px',
              boxShadow: '0 10px 40px rgba(0,0,0,0.3)',
              zIndex: 10000,
              animation: 'slideIn 0.3s ease-out',
              maxWidth: '300px'
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                <span style={{ fontSize: '1.1rem', fontWeight: 600 }}>{message}</span>
                <button onClick={onClose} style={{
                  background: 'none', border: 'none', color: '#FFF',
                  cursor: 'pointer', padding: '0', marginLeft: 'auto'
                }}>
                  <X size={20} />
                </button>
              </div>
            </div>
          );
        };

        // Main App Component
        const WineApp = () => {
          const [scanning, setScanning] = useState(false);
          const [result, setResult] = useState(null);
          const [error, setError] = useState(null);
          const [analyzing, setAnalyzing] = useState(false);
          const [history, setHistory] = useState([]);
          const [favorites, setFavorites] = useState([]);
          const [showHistory, setShowHistory] = useState(false);
          const [showFavorites, setShowFavorites] = useState(false);
          const [toast, setToast] = useState(null);
          const [editingNote, setEditingNote] = useState(null);
          const scannerRef = useRef(null);

          useEffect(() => {
            const savedHistory = localStorage.getItem('wineHistory');
            const savedFavorites = localStorage.getItem('wineFavorites');
            if (savedHistory) setHistory(JSON.parse(savedHistory));
            if (savedFavorites) setFavorites(JSON.parse(savedFavorites));
          }, []);

          const showToast = (message, type = 'success') => {
            setToast({ message, type });
          };

          const startScanner = async () => {
            try {
              setScanning(true);
              setError(null);
              setResult(null);
              
              const html5QrCode = new Html5Qrcode("reader");
              scannerRef.current = html5QrCode;

              const config = { 
                fps: 10,
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0,
                formatsToSupport: [
                  Html5QrcodeSupportedFormats.EAN_13,
                  Html5QrcodeSupportedFormats.EAN_8,
                  Html5QrcodeSupportedFormats.UPC_A,
                  Html5QrcodeSupportedFormats.UPC_E,
                  Html5QrcodeSupportedFormats.CODE_128,
                  Html5QrcodeSupportedFormats.CODE_39
                ]
              };

              await html5QrCode.start(
                { facingMode: "environment" },
                config,
                async (decodedText) => {
                  console.log(`Zeskanowano kod: ${decodedText}`);
                  await stopScanner();
                  await analyzeBarcode(decodedText);
                },
                (errorMessage) => {
                  // Ignorujemy błędy skanowania (normalne gdy nie ma kodu w kadrze)
                }
              );
            } catch (err) {
              console.error('Błąd kamery:', err);
              setError('Nie można uruchomić kamery. Sprawdź uprawnienia.');
              setScanning(false);
            }
          };

          const stopScanner = async () => {
            if (scannerRef.current) {
              try {
                await scannerRef.current.stop();
                scannerRef.current = null;
              } catch (err) {
                console.error('Błąd zatrzymywania skanera:', err);
              }
            }
            setScanning(false);
          };

          const analyzeBarcode = async (barcode) => {
            setAnalyzing(true);
            setError(null);

            try {
              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  model: "claude-sonnet-4-20250514",
                  max_tokens: 1000,
                  messages: [
                    { 
                      role: "user", 
                      content: `Zeskanowałem kod kreskowy wina: ${barcode}

Wyszukaj w internecie informacje o tym winie i podaj w formacie JSON:
{
  "nazwa": "pełna nazwa wina",
  "producent": "nazwa producenta",
  "kraj": "kraj pochodzenia",
  "region": "region",
  "rodzaj": "czerwone/białe/różowe",
  "szczep": "szczepy winogron",
  "rocznik": "rocznik lub 'NV'",
  "slodosc": "wytrawne/półwytrawne/półsłodkie/słodkie",
  "alkohol": "zawartość alkoholu",
  "szczegoly": "krótki opis charakterystyki",
  "zalecenia": "do czego podawać"
}

Jeśli nie znajdziesz konkretnego wina, zwróć:
{
  "error": "Nie znaleziono informacji o tym winie",
  "barcode": "${barcode}"
}` 
                    }
                  ],
                  tools: [
                    {
                      "type": "web_search_20250305",
                      "name": "web_search"
                    }
                  ]
                })
              });

              if (!response.ok) {
                throw new Error('Błąd API');
              }

              const data = await response.json();
              const textContent = data.content
                .filter(item => item.type === "text")
                .map(item => item.text)
                .join("");

              let wineData;
              try {
                const jsonMatch = textContent.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                  wineData = JSON.parse(jsonMatch[0]);
                } else {
                  throw new Error('Brak danych JSON');
                }
              } catch (parseError) {
                throw new Error('Nieprawidłowy format odpowiedzi');
              }

              if (wineData.error) {
                setError(wineData.error);
              } else {
                wineData.barcode = barcode;
                wineData.timestamp = new Date().toISOString();
                setResult(wineData);
                
                const newHistory = [wineData, ...history.filter(h => h.barcode !== barcode)].slice(0, 50);
                setHistory(newHistory);
                localStorage.setItem('wineHistory', JSON.stringify(newHistory));
                
                showToast('Wino znalezione!');
              }
            } catch (err) {
              console.error('Błąd analizy:', err);
              setError('Nie udało się przeanalizować kodu. Spróbuj ponownie.');
            } finally {
              setAnalyzing(false);
            }
          };

          const reset = () => {
            setResult(null);
            setError(null);
            setAnalyzing(false);
          };

          const toggleFavorite = (wine) => {
            const isFavorite = favorites.some(f => f.barcode === wine.barcode);
            let newFavorites;
            
            if (isFavorite) {
              newFavorites = favorites.filter(f => f.barcode !== wine.barcode);
              showToast('Usunięto z ulubionych', 'success');
            } else {
              newFavorites = [wine, ...favorites];
              showToast('Dodano do ulubionych', 'success');
            }
            
            setFavorites(newFavorites);
            localStorage.setItem('wineFavorites', JSON.stringify(newFavorites));
          };

          const deleteFromHistory = (barcode) => {
            const newHistory = history.filter(h => h.barcode !== barcode);
            setHistory(newHistory);
            localStorage.setItem('wineHistory', JSON.stringify(newHistory));
            showToast('Usunięto z historii', 'success');
          };

          const exportData = () => {
            const data = JSON.stringify({ history, favorites }, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `winoteka-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showToast('Dane wyeksportowane', 'success');
          };

          const shareWine = async (wine) => {
            const text = `${wine.nazwa} - ${wine.producent}\n${wine.rodzaj} • ${wine.kraj}\n${wine.szczep || ''}`;
            
            if (navigator.share) {
              try {
                await navigator.share({ text });
                showToast('Udostępniono', 'success');
              } catch (err) {
                console.log('Anulowano udostępnianie');
              }
            } else {
              navigator.clipboard.writeText(text);
              showToast('Skopiowano do schowka', 'success');
            }
          };

          const addNote = (wine, note) => {
            const updatedWine = { ...wine, note };
            
            const newHistory = history.map(h => h.barcode === wine.barcode ? updatedWine : h);
            setHistory(newHistory);
            localStorage.setItem('wineHistory', JSON.stringify(newHistory));
            
            if (favorites.some(f => f.barcode === wine.barcode)) {
              const newFavorites = favorites.map(f => f.barcode === wine.barcode ? updatedWine : f);
              setFavorites(newFavorites);
              localStorage.setItem('wineFavorites', JSON.stringify(newFavorites));
            }
            
            setEditingNote(null);
            showToast('Notatka zapisana', 'success');
          };

          const rateWine = (wine, rating) => {
            const updatedWine = { ...wine, rating };
            
            const newHistory = history.map(h => h.barcode === wine.barcode ? updatedWine : h);
            setHistory(newHistory);
            localStorage.setItem('wineHistory', JSON.stringify(newHistory));
            
            if (favorites.some(f => f.barcode === wine.barcode)) {
              const newFavorites = favorites.map(f => f.barcode === wine.barcode ? updatedWine : f);
              setFavorites(newFavorites);
              localStorage.setItem('wineFavorites', JSON.stringify(newFavorites));
            }
            
            showToast('Ocena zapisana', 'success');
          };

          const getSweetnessColor = (slodosc) => {
            const colors = {
              'wytrawne': '#8B4513',
              'półwytrawne': '#D4A574',
              'półsłodkie': '#E8B4A8',
              'słodkie': '#F4C2C2'
            };
            return colors[slodosc?.toLowerCase()] || '#D4A574';
          };

          const WineCard = ({ wine, showActions = true }) => {
            const isFavorite = favorites.some(f => f.barcode === wine.barcode);
            const isEditing = editingNote === wine.barcode;

            return (
              <div style={{
                background: 'rgba(60, 40, 30, 0.7)',
                borderRadius: '15px',
                padding: '1.5rem',
                marginBottom: '1rem',
                border: `2px solid ${getSweetnessColor(wine.slodosc)}`,
                boxShadow: '0 4px 15px rgba(0,0,0,0.3)',
                animation: 'fadeInUp 0.3s ease-out'
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1rem' }}>
                  <div style={{ flex: 1 }}>
                    <h3 style={{ color: '#F5E6D3', margin: '0 0 0.5rem 0', fontSize: '1.5rem', fontWeight: 700 }}>
                      {wine.nazwa}
                    </h3>
                    <p style={{ color: '#D4A574', margin: '0 0 0.5rem 0', fontSize: '1.1rem' }}>
                      {wine.producent}
                    </p>
                    <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap', fontSize: '0.95rem', color: '#E5D5C3' }}>
                      <span>{wine.kraj}</span>
                      <span>•</span>
                      <span>{wine.rodzaj}</span>
                      {wine.rocznik && wine.rocznik !== 'Brak danych' && (
                        <>
                          <span>•</span>
                          <span>{wine.rocznik}</span>
                        </>
                      )}
                    </div>
                  </div>
                  
                  {showActions && (
                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                      <button onClick={() => toggleFavorite(wine)} style={{
                        background: 'rgba(139, 69, 19, 0.5)',
                        border: 'none',
                        borderRadius: '8px',
                        padding: '0.5rem',
                        cursor: 'pointer',
                        color: isFavorite ? '#FF6B6B' : '#D4A574'
                      }}>
                        <Heart size={24} filled={isFavorite} />
                      </button>
                      <button onClick={() => shareWine(wine)} style={{
                        background: 'rgba(139, 69, 19, 0.5)',
                        border: 'none',
                        borderRadius: '8px',
                        padding: '0.5rem',
                        cursor: 'pointer',
                        color: '#D4A574'
                      }}>
                        <Share2 size={24} />
                      </button>
                      {showHistory && (
                        <button onClick={() => deleteFromHistory(wine.barcode)} style={{
                          background: 'rgba(139, 0, 0, 0.5)',
                          border: 'none',
                          borderRadius: '8px',
                          padding: '0.5rem',
                          cursor: 'pointer',
                          color: '#FFB3B3'
                        }}>
                          <Trash2 size={24} />
                        </button>
                      )}
                    </div>
                  )}
                </div>

                <div style={{ 
                  display: 'grid', 
                  gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))', 
                  gap: '0.8rem',
                  marginBottom: '1rem'
                }}>
                  {wine.szczep && wine.szczep !== 'Brak danych' && (
                    <div style={{
                      background: 'rgba(60, 40, 30, 0.6)',
                      padding: '0.8rem',
                      borderRadius: '8px',
                      border: '1px solid rgba(212, 165, 116, 0.2)'
                    }}>
                      <p style={{ fontSize: '0.8rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Szczep</p>
                      <p style={{ fontSize: '1rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>{wine.szczep}</p>
                    </div>
                  )}
                  
                  {wine.slodosc && wine.slodosc !== 'Brak danych' && (
                    <div style={{
                      background: getSweetnessColor(wine.slodosc),
                      padding: '0.8rem',
                      borderRadius: '8px',
                      border: '1px solid rgba(255, 255, 255, 0.2)'
                    }}>
                      <p style={{ fontSize: '0.8rem', color: '#FFF', margin: '0 0 0.3rem 0' }}>Słodkość</p>
                      <p style={{ fontSize: '1rem', color: '#FFF', margin: 0, fontWeight: 600 }}>{wine.slodosc}</p>
                    </div>
                  )}
                  
                  {wine.alkohol && wine.alkohol !== 'Brak danych' && (
                    <div style={{
                      background: 'rgba(60, 40, 30, 0.6)',
                      padding: '0.8rem',
                      borderRadius: '8px',
                      border: '1px solid rgba(212, 165, 116, 0.2)'
                    }}>
                      <p style={{ fontSize: '0.8rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Alkohol</p>
                      <p style={{ fontSize: '1rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>{wine.alkohol}</p>
                    </div>
                  )}
                </div>

                {wine.rating && (
                  <div style={{ marginBottom: '1rem' }}>
                    <div style={{ display: 'flex', gap: '0.3rem' }}>
                      {[1, 2, 3, 4, 5].map(star => (
                        <button
                          key={star}
                          onClick={() => rateWine(wine, star)}
                          style={{
                            background: 'none',
                            border: 'none',
                            cursor: 'pointer',
                            padding: 0,
                            color: '#D4A574'
                          }}
                        >
                          <Star size={24} filled={star <= wine.rating} />
                        </button>
                      ))}
                    </div>
                  </div>
                )}

                {!wine.rating && showActions && (
                  <div style={{ marginBottom: '1rem' }}>
                    <p style={{ fontSize: '0.9rem', color: '#D4A574', marginBottom: '0.5rem' }}>Oceń to wino:</p>
                    <div style={{ display: 'flex', gap: '0.3rem' }}>
                      {[1, 2, 3, 4, 5].map(star => (
                        <button
                          key={star}
                          onClick={() => rateWine(wine, star)}
                          style={{
                            background: 'none',
                            border: 'none',
                            cursor: 'pointer',
                            padding: 0,
                            color: '#D4A574'
                          }}
                        >
                          <Star size={24} />
                        </button>
                      ))}
                    </div>
                  </div>
                )}

                {wine.note && !isEditing && (
                  <div style={{
                    background: 'rgba(60, 40, 30, 0.6)',
                    padding: '1rem',
                    borderRadius: '8px',
                    marginBottom: '1rem',
                    border: '1px solid rgba(212, 165, 116, 0.2)'
                  }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                      <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: 0 }}>Twoja notatka:</p>
                      <button onClick={() => setEditingNote(wine.barcode)} style={{
                        background: 'none',
                        border: 'none',
                        cursor: 'pointer',
                        padding: 0,
                        color: '#D4A574'
                      }}>
                        <Edit size={20} />
                      </button>
                    </div>
                    <p style={{ fontSize: '1rem', color: '#E5D5C3', margin: 0, lineHeight: '1.5' }}>{wine.note}</p>
                  </div>
                )}

                {isEditing && (
                  <div style={{ marginBottom: '1rem' }}>
                    <textarea
                      defaultValue={wine.note || ''}
                      placeholder="Dodaj swoją notatkę degustacyjną..."
                      style={{
                        width: '100%',
                        minHeight: '100px',
                        background: 'rgba(60, 40, 30, 0.6)',
                        border: '1px solid rgba(212, 165, 116, 0.3)',
                        borderRadius: '8px',
                        padding: '1rem',
                        color: '#E5D5C3',
                        fontSize: '1rem',
                        fontFamily: '"Cormorant Garamond", serif',
                        resize: 'vertical',
                        marginBottom: '0.5rem'
                      }}
                      id={`note-${wine.barcode}`}
                    />
                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                      <button onClick={() => {
                        const note = document.getElementById(`note-${wine.barcode}`).value;
                        addNote(wine, note);
                      }} style={{
                        background: 'rgba(16, 185, 129, 0.8)',
                        color: '#FFF',
                        border: 'none',
                        borderRadius: '8px',
                        padding: '0.5rem 1rem',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        fontFamily: '"Cormorant Garamond", serif'
                      }}>
                        Zapisz
                      </button>
                      <button onClick={() => setEditingNote(null)} style={{
                        background: 'rgba(139, 69, 19, 0.5)',
                        color: '#E5D5C3',
                        border: 'none',
                        borderRadius: '8px',
                        padding: '0.5rem 1rem',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        fontFamily: '"Cormorant Garamond", serif'
                      }}>
                        Anuluj
                      </button>
                    </div>
                  </div>
                )}

                {!wine.note && !isEditing && showActions && (
                  <button onClick={() => setEditingNote(wine.barcode)} style={{
                    background: 'rgba(139, 69, 19, 0.5)',
                    color: '#D4A574',
                    border: '1px solid rgba(212, 165, 116, 0.3)',
                    borderRadius: '8px',
                    padding: '0.5rem 1rem',
                    cursor: 'pointer',
                    fontSize: '0.95rem',
                    fontFamily: '"Cormorant Garamond", serif',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem',
                    width: '100%',
                    justifyContent: 'center',
                    marginBottom: '1rem'
                  }}>
                    <Edit size={18} />
                    Dodaj notatkę
                  </button>
                )}

                {wine.timestamp && (
                  <p style={{ fontSize: '0.85rem', color: '#A0826D', margin: '0.5rem 0 0 0', textAlign: 'right' }}>
                    {new Date(wine.timestamp).toLocaleDateString('pl-PL', {
                      day: 'numeric',
                      month: 'long',
                      year: 'numeric',
                      hour: '2-digit',
                      minute: '2-digit'
                    })}
                  </p>
                )}
              </div>
            );
          };

          return (
            <div style={{
              minHeight: '100vh',
              background: 'linear-gradient(135deg, #2C1810 0%, #3D2817 50%, #2C1810 100%)',
              padding: '2rem 1rem'
            }}>
              {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}

              <div style={{ maxWidth: '600px', margin: '0 auto' }}>
                {/* Header */}
                <div style={{
                  textAlign: 'center',
                  marginBottom: '2rem',
                  animation: 'fadeInDown 0.5s ease-out'
                }}>
                  <Wine size={64} style={{ color: '#D4A574', marginBottom: '1rem' }} />
                  <h1 style={{
                    fontSize: '3rem',
                    color: '#F5E6D3',
                    margin: '0 0 0.5rem 0',
                    fontWeight: 700,
                    textShadow: '2px 2px 4px rgba(0,0,0,0.5)'
                  }}>
                    Winoteka
                  </h1>
                  <p style={{
                    fontSize: '1.2rem',
                    color: '#D4A574',
                    margin: 0,
                    fontStyle: 'italic'
                  }}>
                    Odkryj świat wina
                  </p>
                </div>

                {/* Navigation */}
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(4, 1fr)',
                  gap: '0.5rem',
                  marginBottom: '2rem',
                  animation: 'fadeIn 0.5s ease-out'
                }}>
                  <button onClick={() => { setShowHistory(false); setShowFavorites(false); reset(); }} style={{
                    background: !showHistory && !showFavorites && !scanning && !result 
                      ? 'linear-gradient(135deg, #8B4513 0%, #A0522D 100%)'
                      : 'rgba(139, 69, 19, 0.5)',
                    color: '#F5E6D3',
                    border: 'none',
                    borderRadius: '12px',
                    padding: '1rem',
                    cursor: 'pointer',
                    fontFamily: '"Cormorant Garamond", serif',
                    fontSize: '1rem',
                    fontWeight: 600,
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    gap: '0.5rem',
                    transition: 'all 0.3s ease'
                  }}>
                    <Scan size={24} />
                    <span>Skanuj</span>
                  </button>
                  
                  <button onClick={() => { setShowHistory(true); setShowFavorites(false); }} style={{
                    background: showHistory
                      ? 'linear-gradient(135deg, #8B4513 0%, #A0522D 100%)'
                      : 'rgba(139, 69, 19, 0.5)',
                    color: '#F5E6D3',
                    border: 'none',
                    borderRadius: '12px',
                    padding: '1rem',
                    cursor: 'pointer',
                    fontFamily: '"Cormorant Garamond", serif',
                    fontSize: '1rem',
                    fontWeight: 600,
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    gap: '0.5rem',
                    transition: 'all 0.3s ease',
                    position: 'relative'
                  }}>
                    <History size={24} />
                    <span>Historia</span>
                    {history.length > 0 && (
                      <span style={{
                        position: 'absolute',
                        top: '0.5rem',
                        right: '0.5rem',
                        background: '#10B981',
                        color: '#FFF',
                        fontSize: '0.7rem',
                        padding: '0.2rem 0.5rem',
                        borderRadius: '10px',
                        fontWeight: 700
                      }}>
                        {history.length}
                      </span>
                    )}
                  </button>
                  
                  <button onClick={() => { setShowFavorites(true); setShowHistory(false); }} style={{
                    background: showFavorites
                      ? 'linear-gradient(135deg, #8B4513 0%, #A0522D 100%)'
                      : 'rgba(139, 69, 19, 0.5)',
                    color: '#F5E6D3',
                    border: 'none',
                    borderRadius: '12px',
                    padding: '1rem',
                    cursor: 'pointer',
                    fontFamily: '"Cormorant Garamond", serif',
                    fontSize: '1rem',
                    fontWeight: 600,
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    gap: '0.5rem',
                    transition: 'all 0.3s ease',
                    position: 'relative'
                  }}>
                    <Heart size={24} />
                    <span>Ulubione</span>
                    {favorites.length > 0 && (
                      <span style={{
                        position: 'absolute',
                        top: '0.5rem',
                        right: '0.5rem',
                        background: '#FF6B6B',
                        color: '#FFF',
                        fontSize: '0.7rem',
                        padding: '0.2rem 0.5rem',
                        borderRadius: '10px',
                        fontWeight: 700
                      }}>
                        {favorites.length}
                      </span>
                    )}
                  </button>
                  
                  <button onClick={exportData} style={{
                    background: 'rgba(139, 69, 19, 0.5)',
                    color: '#F5E6D3',
                    border: 'none',
                    borderRadius: '12px',
                    padding: '1rem',
                    cursor: 'pointer',
                    fontFamily: '"Cormorant Garamond", serif',
                    fontSize: '1rem',
                    fontWeight: 600,
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    gap: '0.5rem',
                    transition: 'all 0.3s ease'
                  }}>
                    <Download size={24} />
                    <span>Export</span>
                  </button>
                </div>

                {/* History View */}
                {showHistory && (
                  <div style={{ animation: 'fadeIn 0.5s ease-out' }}>
                    <h2 style={{
                      fontSize: '2rem',
                      color: '#D4A574',
                      marginBottom: '1.5rem',
                      textAlign: 'center',
                      fontWeight: 600
                    }}>
                      Historia skanowań
                    </h2>
                    {history.length === 0 ? (
                      <div style={{
                        textAlign: 'center',
                        padding: '3rem 1rem',
                        background: 'rgba(60, 40, 30, 0.6)',
                        borderRadius: '15px',
                        border: '1px solid rgba(212, 165, 116, 0.2)'
                      }}>
                        <History size={64} style={{ color: '#D4A574', marginBottom: '1rem' }} />
                        <p style={{ fontSize: '1.2rem', color: '#D4A574', margin: 0 }}>
                          Nie masz jeszcze żadnych zeskanowanych win
                        </p>
                      </div>
                    ) : (
                      <>
                        {history.map((wine, index) => (
                          <WineCard key={index} wine={wine} />
                        ))}
                      </>
                    )}
                  </div>
                )}

                {/* Favorites View */}
                {showFavorites && (
                  <div style={{ animation: 'fadeIn 0.5s ease-out' }}>
                    <h2 style={{
                      fontSize: '2rem',
                      color: '#D4A574',
                      marginBottom: '1.5rem',
                      textAlign: 'center',
                      fontWeight: 600
                    }}>
                      Ulubione wina
                    </h2>
                    {favorites.length === 0 ? (
                      <div style={{
                        textAlign: 'center',
                        padding: '3rem 1rem',
                        background: 'rgba(60, 40, 30, 0.6)',
                        borderRadius: '15px',
                        border: '1px solid rgba(212, 165, 116, 0.2)'
                      }}>
                        <Heart size={64} style={{ color: '#D4A574', marginBottom: '1rem' }} />
                        <p style={{ fontSize: '1.2rem', color: '#D4A574', margin: 0 }}>
                          Nie masz jeszcze ulubionych win
                        </p>
                      </div>
                    ) : (
                      <>
                        {favorites.map((wine, index) => (
                          <WineCard key={index} wine={wine} showActions={false} />
                        ))}
                      </>
                    )}
                  </div>
                )}

                {/* Scanner View */}
                {!showHistory && !showFavorites && !result && !error && !analyzing && (
                  <div style={{ animation: 'fadeIn 0.5s ease-out' }}>
                    {!scanning ? (
                      <div style={{
                        background: 'rgba(60, 40, 30, 0.7)',
                        borderRadius: '20px',
                        padding: '3rem 2rem',
                        textAlign: 'center',
                        border: '2px solid rgba(212, 165, 116, 0.3)',
                        boxShadow: '0 8px 32px rgba(0,0,0,0.3)'
                      }}>
                        <Scan size={80} style={{ color: '#D4A574', marginBottom: '2rem' }} />
                        <h2 style={{
                          fontSize: '2rem',
                          color: '#F5E6D3',
                          marginBottom: '1rem',
                          fontWeight: 600
                        }}>
                          Rozpocznij skanowanie
                        </h2>
                        <p style={{
                          fontSize: '1.2rem',
                          color: '#D4A574',
                          marginBottom: '2rem',
                          lineHeight: '1.6'
                        }}>
                          Zeskanuj kod kreskowy na etykiecie wina,<br/>
                          aby poznać jego szczegóły
                        </p>
                        <button onClick={startScanner} style={{
                          background: 'linear-gradient(135deg, #8B4513 0%, #A0522D 100%)',
                          color: '#FFF',
                          border: 'none',
                          borderRadius: '15px',
                          padding: '1.2rem 3rem',
                          fontSize: '1.4rem',
                          fontWeight: 700,
                          cursor: 'pointer',
                          fontFamily: '"Cormorant Garamond", serif',
                          textTransform: 'uppercase',
                          letterSpacing: '1px',
                          boxShadow: '0 4px 15px rgba(139, 69, 19, 0.5)',
                          transition: 'all 0.3s ease'
                        }}>
                          Uruchom kamerę
                        </button>
                      </div>
                    ) : (
                      <div style={{
                        background: 'rgba(60, 40, 30, 0.9)',
                        borderRadius: '20px',
                        padding: '1.5rem',
                        border: '2px solid #10B981',
                        boxShadow: '0 8px 32px rgba(0,0,0,0.5)'
                      }}>
                        <div style={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center',
                          marginBottom: '1rem'
                        }}>
                          <h3 style={{ color: '#10B981', margin: 0, fontSize: '1.5rem', fontWeight: 600 }}>
                            Skanowanie aktywne
                          </h3>
                          <button onClick={stopScanner} style={{
                            background: 'rgba(220, 38, 38, 0.8)',
                            color: '#FFF',
                            border: 'none',
                            borderRadius: '8px',
                            padding: '0.5rem 1rem',
                            cursor: 'pointer',
                            fontFamily: '"Cormorant Garamond", serif',
                            fontSize: '1rem',
                            fontWeight: 600
                          }}>
                            Zatrzymaj
                          </button>
                        </div>
                        
                        <div id="reader" style={{ marginBottom: '1rem' }}></div>
                        
                        <div style={{
                          background: 'rgba(16, 185, 129, 0.2)',
                          border: '1px solid rgba(16, 185, 129, 0.5)',
                          borderRadius: '10px',
                          padding: '1rem',
                          color: '#10B981'
                        }}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem' }}>
                            <Info size={20} />
                            <span style={{ fontWeight: 600 }}>Wskazówka:</span>
                          </div>
                          <p style={{ margin: 0, fontSize: '0.95rem', lineHeight: '1.5' }}>
                            Skieruj kamerę na kod kreskowy na etykiecie wina. 
                            Upewnij się, że kod jest dobrze oświetlony i w całości widoczny w ramce.
                          </p>
                        </div>
                      </div>
                    )}
                  </div>
                )}

                {/* Results View */}
                {!showHistory && !showFavorites && (result || error || analyzing) && (
                  <div style={{ animation: 'fadeIn 0.5s ease-out' }}>
                    {result && !analyzing && !error && (
                      <div style={{
                        background: 'rgba(60, 40, 30, 0.9)',
                        borderRadius: '20px',
                        padding: '2rem',
                        border: `3px solid ${getSweetnessColor(result.slodosc)}`,
                        boxShadow: '0 8px 32px rgba(0,0,0,0.5)',
                        animation: 'fadeInUp 0.5s ease-out'
                      }}>
                        <div style={{
                          textAlign: 'center',
                          marginBottom: '2rem',
                          paddingBottom: '2rem',
                          borderBottom: '2px solid rgba(212, 165, 116, 0.3)'
                        }}>
                          <Wine size={64} style={{ color: getSweetnessColor(result.slodosc), marginBottom: '1rem' }} />
                          <h2 style={{
                            fontSize: '2.5rem',
                            color: '#F5E6D3',
                            margin: '0 0 0.5rem 0',
                            fontWeight: 700
                          }}>
                            {result.nazwa}
                          </h2>
                          <p style={{
                            fontSize: '1.5rem',
                            color: '#D4A574',
                            margin: '0 0 1rem 0',
                            fontWeight: 600
                          }}>
                            {result.producent}
                          </p>
                          <div style={{
                            display: 'flex',
                            gap: '1rem',
                            justifyContent: 'center',
                            flexWrap: 'wrap',
                            fontSize: '1.1rem',
                            color: '#E5D5C3'
                          }}>
                            <span>{result.kraj}</span>
                            {result.region && result.region !== 'Brak danych' && (
                              <>
                                <span>•</span>
                                <span>{result.region}</span>
                              </>
                            )}
                            <span>•</span>
                            <span>{result.rodzaj}</span>
                            {result.rocznik && result.rocznik !== 'Brak danych' && (
                              <>
                                <span>•</span>
                                <span>{result.rocznik}</span>
                              </>
                            )}
                          </div>
                        </div>

                        <div style={{
                          display: 'grid',
                          gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))',
                          gap: '1rem',
                          marginBottom: '2rem'
                        }}>
                          {result.szczep && result.szczep !== 'Brak danych' && (
                            <div style={{
                              background: 'rgba(60, 40, 30, 0.6)', padding: '1rem',
                              borderRadius: '10px', border: '1px solid rgba(212, 165, 116, 0.2)'
                            }}>
                              <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Szczep</p>
                              <p style={{ fontSize: '1.2rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                {result.szczep}
                              </p>
                            </div>
                          )}
                          
                          {result.slodosc && result.slodosc !== 'Brak danych' && (
                            <div style={{
                              background: getSweetnessColor(result.slodosc), padding: '1rem',
                              borderRadius: '10px', border: '1px solid rgba(255, 255, 255, 0.2)'
                            }}>
                              <p style={{ fontSize: '0.9rem', color: '#FFF', margin: '0 0 0.3rem 0' }}>Słodkość</p>
                              <p style={{ fontSize: '1.2rem', color: '#FFF', margin: 0, fontWeight: 600 }}>
                                {result.slodosc}
                              </p>
                            </div>
                          )}
                          
                          {result.alkohol && result.alkohol !== 'Brak danych' && (
                            <div style={{
                              background: 'rgba(60, 40, 30, 0.6)', padding: '1rem',
                              borderRadius: '10px', border: '1px solid rgba(212, 165, 116, 0.2)'
                            }}>
                              <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.3rem 0' }}>Alkohol</p>
                              <p style={{ fontSize: '1.2rem', color: '#F5E6D3', margin: 0, fontWeight: 600 }}>
                                {result.alkohol}
                              </p>
                            </div>
                          )}
                        </div>

                        {result.szczegoly && result.szczegoly !== 'Brak danych' && (
                          <div style={{
                            background: 'rgba(60, 40, 30, 0.6)', padding: '1.5rem',
                            borderRadius: '12px', marginBottom: '1rem',
                            border: '1px solid rgba(212, 165, 116, 0.2)'
                          }}>
                            <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.5rem 0', fontWeight: 600 }}>
                              Charakterystyka
                            </p>
                            <p style={{ fontSize: '1.1rem', color: '#E5D5C3', margin: 0, lineHeight: '1.6' }}>
                              {result.szczegoly}
                            </p>
                          </div>
                        )}

                        {result.zalecenia && result.zalecenia !== 'Brak danych' && (
                          <div style={{
                            background: 'rgba(60, 40, 30, 0.6)', padding: '1.5rem',
                            borderRadius: '12px', marginBottom: '1.5rem',
                            border: '1px solid rgba(212, 165, 116, 0.2)'
                          }}>
                            <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: '0 0 0.5rem 0', fontWeight: 600 }}>
                              Zalecenia
                            </p>
                            <p style={{ fontSize: '1.1rem', color: '#E5D5C3', margin: 0, lineHeight: '1.6' }}>
                              {result.zalecenia}
                            </p>
                          </div>
                        )}

                        <button onClick={reset} style={{
                          width: '100%', background: 'linear-gradient(135deg, #8B4513 0%, #A0522D 100%)',
                          color: '#FFF', border: 'none', borderRadius: '12px', padding: '1rem 2rem',
                          fontSize: '1.2rem', fontWeight: 600, cursor: 'pointer',
                          fontFamily: '"Cormorant Garamond", serif', textTransform: 'uppercase'
                        }}>
                          Skanuj kolejne wino
                        </button>
                      </div>
                    )}

                    {error && !result && (
                      <div style={{
                        background: 'rgba(139, 0, 0, 0.3)', border: '1px solid rgba(255, 100, 100, 0.5)',
                        borderRadius: '10px', padding: '1.5rem', marginTop: '1rem',
                        color: '#FFB3B3', textAlign: 'center'
                      }}>
                        <p style={{ margin: '0 0 1rem 0', fontSize: '1.1rem' }}>{error}</p>
                        <button onClick={reset} style={{
                          background: 'rgba(139, 69, 19, 0.8)', color: '#F5E6D3',
                          border: 'none', borderRadius: '8px', padding: '0.8rem 1.5rem',
                          fontSize: '1rem', cursor: 'pointer', fontFamily: '"Cormorant Garamond", serif'
                        }}>
                          Spróbuj ponownie
                        </button>
                      </div>
                    )}

                    {analyzing && (
                      <div style={{ textAlign: 'center', padding: '2rem' }}>
                        <Loader2 size={48} style={{ color: '#D4A574', animation: 'spin 1s linear infinite', marginBottom: '1rem' }} />
                        <p style={{ fontSize: '1.3rem', color: '#D4A574', margin: 0 }}>
                          Wyszukuję informacje...
                        </p>
                      </div>
                    )}
                  </div>
                )}

                {/* Legend */}
                {!showHistory && !showFavorites && !scanning && !result && !error && !analyzing && (
                  <div style={{
                    marginTop: '2rem', background: 'rgba(60, 40, 30, 0.6)',
                    borderRadius: '15px', padding: '1.5rem',
                    border: '1px solid rgba(212, 165, 116, 0.2)'
                  }}>
                    <h3 style={{
                      fontSize: '1.3rem', color: '#D4A574', marginBottom: '1rem',
                      textAlign: 'center', fontWeight: 600
                    }}>Skala słodkości win</h3>
                    <div style={{
                      display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem'
                    }}>
                      {[
                        { name: 'Wytrawne', color: '#8B4513', icon: '●○○○' },
                        { name: 'Półwytrawne', color: '#D4A574', icon: '●●○○' },
                        { name: 'Półsłodkie', color: '#E8B4A8', icon: '●●●○' },
                        { name: 'Słodkie', color: '#F4C2C2', icon: '●●●●' }
                      ].map((item, i) => (
                        <div key={i} style={{
                          background: item.color, padding: '0.8rem', borderRadius: '8px',
                          textAlign: 'center', border: '1px solid rgba(255,255,255,0.2)'
                        }}>
                          <p style={{ fontSize: '1rem', fontWeight: 600, color: '#FFF', margin: '0 0 0.3rem 0' }}>
                            {item.name}
                          </p>
                          <p style={{ fontSize: '1.2rem', color: '#FFF', margin: 0, letterSpacing: '0.2em' }}>
                            {item.icon}
                          </p>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Footer */}
                <div style={{
                  marginTop: '3rem', textAlign: 'center', padding: '1.5rem',
                  background: 'rgba(60, 40, 30, 0.4)', borderRadius: '12px',
                  border: '1px solid rgba(212, 165, 116, 0.2)'
                }}>
                  <p style={{ fontSize: '0.9rem', color: '#D4A574', margin: 0, lineHeight: '1.6' }}>
                    Powered by Claude AI • Winoteka v4.1<br/>
                    © 2026 Winoteka - Odkryj świat wina
                  </p>
                </div>
              </div>

              <style>{`
                @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&display=swap');
                
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
                @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
                @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
                
                ::-webkit-scrollbar { width: 8px; }
                ::-webkit-scrollbar-track { background: rgba(60, 40, 30, 0.3); border-radius: 4px; }
                ::-webkit-scrollbar-thumb { background: rgba(212, 165, 116, 0.5); border-radius: 4px; }
                ::-webkit-scrollbar-thumb:hover { background: rgba(212, 165, 116, 0.8); }
              `}</style>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WineApp />);
    </script>
</body>
</html>
