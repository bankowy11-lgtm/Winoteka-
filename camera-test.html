<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Kamery - Vino Scanner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #1a0e0e;
            color: #fcd34d;
        }
        h1 {
            text-align: center;
            color: #fbbf24;
        }
        video {
            width: 100%;
            max-width: 400px;
            display: block;
            margin: 20px auto;
            border: 2px solid #fbbf24;
            border-radius: 8px;
        }
        button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #d97706;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background: #f59e0b;
        }
        .info {
            padding: 15px;
            background: rgba(217, 119, 6, 0.2);
            border: 1px solid rgba(217, 119, 6, 0.4);
            border-radius: 8px;
            margin: 20px 0;
        }
        .success {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.4);
        }
        .error {
            background: rgba(220, 38, 38, 0.2);
            border-color: rgba(220, 38, 38, 0.4);
        }
    </style>
</head>
<body>
    <h1>ğŸ¥ Test Kamery</h1>
    
    <div class="info">
        <strong>Ten plik testuje dostÄ™p do kamery.</strong><br>
        JeÅ›li zobaczysz obraz z kamery - wszystko dziaÅ‚a!
    </div>

    <div id="status" class="info">
        Kliknij przycisk poniÅ¼ej aby rozpoczÄ…Ä‡ test...
    </div>

    <button onclick="testCamera()">ğŸš€ Uruchom Test Kamery</button>
    <button onclick="stopCamera()" style="background: #7f1d1d;">ğŸ›‘ Zatrzymaj KamerÄ™</button>

    <video id="video" autoplay playsinline style="display: none;"></video>

    <div class="info">
        <h3>RozwiÄ…zywanie problemÃ³w:</h3>
        <ul>
            <li>âœ… Strona musi uÅ¼ywaÄ‡ HTTPS (GitHub Pages âœ“)</li>
            <li>âœ… Musisz kliknÄ…Ä‡ "ZezwÃ³l" gdy pojawi siÄ™ pytanie</li>
            <li>âœ… SprawdÅº uprawnienia w Chrome (kÅ‚Ã³dka obok URL)</li>
            <li>âœ… Zamknij inne aplikacje uÅ¼ywajÄ…ce kamery</li>
        </ul>
    </div>

    <div class="info">
        <strong>Aktualna strona:</strong><br>
        <span id="url-info"></span>
    </div>

    <script>
        let stream = null;
        const video = document.getElementById('video');
        const status = document.getElementById('status');
        const urlInfo = document.getElementById('url-info');

        // Show current URL info
        urlInfo.innerHTML = `
            ProtokÃ³Å‚: ${location.protocol}<br>
            Host: ${location.hostname}<br>
            ${location.protocol === 'https:' ? 'âœ… HTTPS - OK!' : 'âŒ BRAK HTTPS - Kamera nie bÄ™dzie dziaÅ‚aÄ‡!'}
        `;

        async function testCamera() {
            status.className = 'info';
            status.innerHTML = 'â³ ProszÄ™ czekaÄ‡... PrÃ³ba dostÄ™pu do kamery...';

            try {
                // Request camera access
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment' 
                    } 
                });

                // Success!
                video.srcObject = stream;
                video.style.display = 'block';
                
                status.className = 'info success';
                status.innerHTML = `
                    <strong>âœ… SUKCES!</strong><br>
                    Kamera dziaÅ‚a prawidÅ‚owo!<br>
                    <small>Aplikacja Vino Scanner powinna dziaÅ‚aÄ‡ bez problemu.</small>
                `;

            } catch (err) {
                // Error!
                status.className = 'info error';
                status.innerHTML = `
                    <strong>âŒ BÅÄ„D!</strong><br>
                    ${err.name}: ${err.message}<br><br>
                    <strong>Co zrobiÄ‡:</strong><br>
                    ${getErrorHelp(err.name)}
                `;
                console.error('Camera error:', err);
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                video.style.display = 'none';
                status.className = 'info';
                status.innerHTML = 'Kamera zatrzymana. Kliknij "Uruchom Test" aby sprÃ³bowaÄ‡ ponownie.';
            }
        }

        function getErrorHelp(errorName) {
            switch(errorName) {
                case 'NotAllowedError':
                    return `
                        1. Kliknij ikonÄ™ kÅ‚Ã³dki obok adresu URL<br>
                        2. ZnajdÅº "Uprawnienia" â†’ "Kamera"<br>
                        3. Ustaw na "Zezwalaj"<br>
                        4. OdÅ›wieÅ¼ stronÄ™ (F5)
                    `;
                case 'NotFoundError':
                    return `
                        Nie znaleziono kamery!<br>
                        SprawdÅº czy urzÄ…dzenie ma kamerÄ™.
                    `;
                case 'NotReadableError':
                    return `
                        Kamera jest zajÄ™ta!<br>
                        Zamknij inne aplikacje uÅ¼ywajÄ…ce kamery.
                    `;
                case 'SecurityError':
                    return `
                        Problem z bezpieczeÅ„stwem!<br>
                        Strona musi uÅ¼ywaÄ‡ HTTPS.<br>
                        Wgraj na GitHub Pages.
                    `;
                default:
                    return `
                        Nieznany bÅ‚Ä…d. SprÃ³buj:<br>
                        - OdÅ›wieÅ¼yÄ‡ stronÄ™<br>
                        - ZrestartowaÄ‡ przeglÄ…darkÄ™<br>
                        - SprawdziÄ‡ uprawnienia systemowe
                    `;
            }
        }

        // Check permissions on load
        if (navigator.permissions) {
            navigator.permissions.query({ name: 'camera' }).then(function(result) {
                if (result.state === 'denied') {
                    status.className = 'info error';
                    status.innerHTML = `
                        âš ï¸ <strong>Uprawnienia do kamery sÄ… zablokowane!</strong><br>
                        WÅ‚Ä…cz je w ustawieniach przeglÄ…darki przed testem.
                    `;
                }
            }).catch(function(err) {
                console.log('Permission query not supported');
            });
        }
    </script>
</body>
</html>
